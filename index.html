<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Smart Investment Enterprise - Inverse Risk Model</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/numeral@2.0.6/numeral.min.js"></script>
    
    <!-- Firebase v12 CDN -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, getDocs, orderBy, onSnapshot, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBlCwlyX3ujq4R_FDWiGni_4FnQnX8C5hk",
            authDomain: "nexus-nexus.firebaseapp.com",
            projectId: "nexus-nexus",
            storageBucket: "nexus-nexus.firebasestorage.app",
            messagingSenderId: "769766068333",
            appId: "1:769766068333:web:d0676159280493d41e2f64",
            measurementId: "G-ND03G3PGHD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCreateUser = createUserWithEmailAndPassword;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseDoc = doc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseAddDoc = addDoc;
        window.firebaseCollection = collection;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseGetDocs = getDocs;
        window.firebaseOrderBy = orderBy;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseIncrement = increment;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>
    
    <style>
        /* ===== GLOBAL STYLES ===== */
        :root {
            --brand-gold: #d4af37;
            --brand-dark: #000000;
            --text-light: #ffffff;
            --text-dark: #111827;
            --bg-light: #f2f6fc;
            --bg-dark: #0d1117;
            --card-light: rgba(255, 255, 255, 0.8);
            --card-dark: rgba(0, 0, 0, 0.4);
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.3);
            --border-light: rgba(0, 0, 0, 0.1);
            --border-dark: rgba(255, 255, 255, 0.1);
            --success: #00c851;
            --warning: #ffbb33;
            --danger: #ff4444;
            --info: #33b5e5;
            --risk-high: #ff4444;
            --risk-medium: #ffbb33;
            --risk-low: #00c851;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            transition: background-color 0.4s, color 0.4s;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ===== GLASSMORPHISM EFFECT ===== */
        .glass {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .glass {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            text-align: center;
        }

        .btn-primary {
            background: var(--brand-gold);
            color: var(--text-dark);
        }

        .btn-primary:hover {
            background: #b8942f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-dark);
            border: 1px solid var(--border-light);
        }

        .dark-mode .btn-secondary {
            color: var(--text-light);
            border: 1px solid var(--border-dark);
        }

        .btn-secondary:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-loading {
            position: relative;
            color: transparent;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== HEADER & NAVIGATION ===== */
        header {
            background: var(--brand-gold);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .logo i {
            font-size: 28px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s;
        }

        nav a:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .theme-toggle {
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-dark);
        }

        .mobile-menu {
            display: none;
            font-size: 24px;
            cursor: pointer;
        }

        /* ===== PAGES ===== */
        .page {
            display: none;
            flex: 1;
            width: 100%;
        }

        .page.active {
            display: block;
        }

        /* ===== HOME PAGE ===== */
        .hero {
            min-height: calc(100vh - 140px);
            padding: 0 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                              url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
            position: relative;
        }

        .dark-mode .hero {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                              url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--brand-gold), #f1c40f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 20px;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .hero-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* ===== ABOUT PAGE ===== */
        .about-page-content {
            min-height: calc(100vh - 140px);
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .about-content {
            line-height: 1.8;
            font-size: 18px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }

        .about-content h3 {
            margin: 30px 0 15px;
            color: var(--brand-gold);
        }

        .about-content p {
            margin-bottom: 20px;
            text-align: justify;
        }

        /* ===== REVIEWS PAGE ===== */
        .reviews-page-content {
            min-height: calc(100vh - 140px);
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }

        .review-card {
            padding: 20px;
            border-radius: 12px;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        .dark-mode .review-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .review-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .review-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .review-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .review-rating {
            color: var(--brand-gold);
        }

        .review-text {
            line-height: 1.6;
            font-style: italic;
        }

        /* ===== REVIEW FORM ===== */
        .review-form-container {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 12px;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        .dark-mode .review-form-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .review-form h3 {
            margin-bottom: 15px;
            color: var(--brand-gold);
        }

        .rating-input {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .rating-star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .rating-star.active {
            color: var(--brand-gold);
        }

        .review-form textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 16px;
            resize: vertical;
        }

        .dark-mode .review-form textarea {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .review-form button {
            margin-top: 10px;
        }

        /* ===== CONTACT PAGE ===== */
        .contact-page-content {
            min-height: calc(100vh - 140px);
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .contact-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 16px;
        }

        .dark-mode .form-group input,
        .dark-mode .form-group textarea,
        .dark-mode .form-group select {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .contact-info {
            text-align: center;
            margin-top: 30px;
        }

        .contact-email {
            color: var(--brand-gold);
            text-decoration: none;
            cursor: pointer;
            transition: color 0.3s;
        }

        .contact-email:hover {
            text-decoration: underline;
        }

        /* ===== FOOTER ===== */
        footer {
            background: var(--brand-dark);
            color: var(--text-light);
            padding: 20px 0;
            text-align: center;
            width: 100%;
            margin-top: auto;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-links a {
            color: var(--text-light);
            text-decoration: none;
            transition: color 0.3s;
            padding: 5px 10px;
        }

        .footer-links a:hover {
            color: var(--brand-gold);
        }

        .copyright {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.8;
        }

        /* ===== LOGIN/REGISTER PAGE ===== */
        .auth-container {
            min-height: calc(100vh - 140px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }

        .auth-box {
            width: 100%;
            max-width: 500px;
            padding: 40px;
            border-radius: 16px;
            background: var(--card-light);
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .dark-mode .auth-box {
            background: var(--card-dark);
            box-shadow: 0 10px 30px var(--shadow-dark);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .auth-tabs {
            border-bottom: 1px solid var(--border-dark);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-tab.active {
            border-bottom: 3px solid var(--brand-gold);
            color: var(--brand-gold);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Password visibility toggle */
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 38px;
            cursor: pointer;
            color: var(--text-dark);
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .dark-mode .password-toggle {
            color: var(--text-light);
        }

        .password-toggle:hover {
            opacity: 1;
        }

        /* ===== DASHBOARD ===== */
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 140px);
        }

        .sidebar {
            width: 250px;
            background: var(--card-light);
            padding: 20px 0;
            box-shadow: 2px 0 10px var(--shadow-light);
            position: relative;
        }

        .dark-mode .sidebar {
            background: var(--card-dark);
            box-shadow: 2px 0 10px var(--shadow-dark);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 20px;
            position: relative;
        }

        .dark-mode .sidebar-header {
            border-bottom: 1px solid var(--border-dark);
        }

        .sidebar-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.3s;
        }

        .dark-mode .sidebar-menu a {
            color: var(--text-light);
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(212, 175, 55, 0.1);
            border-right: 3px solid var(--brand-gold);
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        /* ===== IMPROVED DASHBOARD STYLES ===== */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .dashboard-title {
            color: var(--brand-gold);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .dashboard-subtitle {
            color: var(--text-dark);
            opacity: 0.8;
            font-size: 16px;
        }

        .dark-mode .dashboard-subtitle {
            color: var(--text-light);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
        }

        .dark-mode .stat-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--brand-gold);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            color: var(--brand-gold);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-card {
            padding: 25px;
            border-radius: 12px;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 20px;
        }

        .dark-mode .dashboard-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .dashboard-card h3 {
            margin-bottom: 20px;
            color: var(--brand-gold);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dashboard-card h3 i {
            font-size: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .info-row {
            border-bottom: 1px solid var(--border-dark);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
        }

        .info-value {
            color: var(--brand-gold);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .payment-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        .dark-mode .payment-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .qr-code {
            width: 150px;
            height: 150px;
            margin: 15px auto;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .transaction-table th,
        .transaction-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .transaction-table th,
        .dark-mode .transaction-table td {
            border-bottom: 1px solid var(--border-dark);
        }

        .transaction-table th {
            font-weight: 600;
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .transaction-table th {
            background: rgba(255, 255, 255, 0.05);
        }

        .status-pending {
            color: var(--warning);
            font-weight: 600;
        }

        .status-approved {
            color: var(--success);
            font-weight: 600;
        }

        .status-declined {
            color: var(--danger);
            font-weight: 600;
        }

        .chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
            overflow: hidden;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        .dark-mode .chat-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .chat-header {
            padding: 15px 20px;
            background: var(--brand-gold);
            color: var(--text-dark);
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.4;
        }

        .message.user {
            align-self: flex-end;
            background: var(--brand-gold);
            color: var(--text-dark);
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            align-self: flex-start;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-bottom-left-radius: 5px;
        }

        .dark-mode .message.ai {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--border-light);
        }

        .dark-mode .chat-input {
            border-top: 1px solid var(--border-dark);
        }

        .chat-input input {
            flex: 1;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
        }

        .dark-mode .chat-input input {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .chat-input button {
            margin-left: 10px;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            background: var(--brand-gold);
            color: var(--text-dark);
            cursor: pointer;
            font-weight: 600;
        }

        .notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }

        .notification {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-light);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .notification {
            box-shadow: 0 4px 12px var(--shadow-dark);
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.info {
            background: var(--info);
            color: white;
        }

        .notification.warning {
            background: var(--warning);
            color: var(--text-dark);
        }

        .notification.error {
            background: var(--danger);
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== INVESTMENT PLANS ===== */
        .investment-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .investment-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .investment-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .investment-card:hover {
            transform: translateY(-5px);
        }

        .investment-card h3 {
            color: var(--brand-gold);
            margin-bottom: 15px;
        }

        .investment-card p {
            margin: 10px 0;
            font-size: 16px;
        }

        .investment-card .btn {
            margin-top: 15px;
            width: 100%;
        }

        .risk-indicator {
            position: absolute;
            top: 0;
            right: 0;
            padding: 5px 10px;
            border-radius: 0 0 0 8px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .risk-high {
            background-color: var(--risk-high);
            color: white;
        }

        .risk-medium {
            background-color: var(--risk-medium);
            color: var(--text-dark);
        }

        .risk-low {
            background-color: var(--risk-low);
            color: white;
        }

        /* ===== AI CHAT BOT ===== */
        .ai-chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 340px;
            height: 420px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: Arial, sans-serif;
            color: #333;
            z-index: 999;
        }

        .dark-mode .ai-chat-container {
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
        }

        .ai-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .ai-chat-header button {
            background: none;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        .ai-chat-body {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
        }

        .dark-mode .ai-chat-body {
            background: rgba(0, 0, 0, 0.4);
            color: #fff;
        }

        .ai-chat-input-area {
            display: flex;
            border-top: 1px solid rgba(0, 0, 0, 0.2);
        }

        .dark-mode .ai-chat-input-area {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ai-chat-input-area input {
            flex: 1;
            border: none;
            padding: 10px;
            font-size: 14px;
            outline: none;
            background: rgba(255, 255, 255, 0.7);
            color: #333;
        }

        .dark-mode .ai-chat-input-area input {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .ai-chat-input-area button {
            background: #0072ff;
            border: none;
            padding: 10px 16px;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            border-radius: 0 0 12px 0;
        }

        .ai-user-message, .ai-bot-message {
            margin: 6px 0;
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .ai-user-message {
            background: rgba(0, 183, 255, 0.25);
            align-self: flex-end;
            margin-left: auto;
            color: #333;
        }

        .dark-mode .ai-user-message {
            color: #fff;
        }

        .ai-bot-message {
            background: rgba(255, 255, 255, 0.7);
            align-self: flex-start;
            color: #333;
        }

        .dark-mode .ai-bot-message {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        /* ===== MERGED INVESTMENT & DEPOSIT SECTION ===== */
        .investment-deposit-flow {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }

        .plan-selection {
            flex: 1;
        }

        .deposit-section {
            flex: 1;
            display: none;
        }

        .deposit-section.active {
            display: block;
        }

        .selected-plan-info {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--brand-gold);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .plan-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--brand-gold);
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .step-content {
            flex: 1;
        }

        /* ===== CRYPTO ADDRESS UPLOAD STYLES ===== */
        .crypto-address-upload {
            margin-bottom: 20px;
        }

        .crypto-address-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .crypto-address-area {
            border: 2px dashed var(--border-light);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--card-light);
        }

        .dark-mode .crypto-address-area {
            border-color: var(--border-dark);
            background: var(--card-dark);
        }

        .crypto-address-area:hover {
            border-color: var(--brand-gold);
        }

        .crypto-address-area.active {
            border-color: var(--brand-gold);
            background: rgba(212, 175, 55, 0.05);
        }

        .crypto-address-icon {
            font-size: 40px;
            color: var(--brand-gold);
            margin-bottom: 10px;
        }

        .crypto-address-text {
            margin-bottom: 10px;
        }

        .crypto-address-btn {
            display: inline-block;
            padding: 8px 16px;
            background: var(--brand-gold);
            color: var(--text-dark);
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }

        .crypto-address-input {
            display: none;
        }

        .crypto-address-preview-container {
            margin-top: 15px;
            display: none;
        }

        .crypto-address-preview-container.active {
            display: block;
        }

        .crypto-address-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .remove-crypto-address {
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* ===== MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            margin: 5% auto;
            max-width: 90%;
            max-height: 80%;
            background: var(--card-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .modal-content {
            background: var(--card-dark);
        }

        .modal-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 992px) {
            .hero h1 {
                font-size: 36px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .investment-deposit-flow {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .mobile-menu {
                display: block;
            }
            
            nav ul {
                display: none;
                position: absolute;
                top: 70px;
                left: 0;
                right: 0;
                background: var(--brand-gold);
                flex-direction: column;
                padding: 20px;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            }
            
            nav ul.show {
                display: flex;
            }
            
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar-menu li {
                flex-shrink: 0;
            }
            
            .sidebar-menu a {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
            }

            .investment-plans {
                grid-template-columns: 1fr;
            }

            .ai-chat-container {
                width: 300px;
                height: 380px;
                right: 10px;
                bottom: 10px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }

            /* ===== MOBILE HEADER LAYOUT ADJUSTMENT ===== */
            .header-content {
                justify-content: space-between;
                padding: 0 10px;
            }

            .logo {
                flex: 1;
            }

            .theme-toggle, .mobile-menu {
                margin-left: 15px;
            }
        }

        @media (max-width: 576px) {
            .hero h1 {
                font-size: 28px;
            }
            
            .hero p {
                font-size: 16px;
            }
            
            .hero-btns {
                flex-direction: column;
                align-items: center;
            }
            
            .section-title {
                font-size: 28px;
            }
            
            .auth-box {
                padding: 20px;
                margin: 10px;
            }

            .ai-chat-container {
                width: 280px;
                height: 360px;
            }
            
            .footer-content {
                padding: 0 15px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* ===== ADDITIONAL FIXES ===== */
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--brand-gold);
            font-size: 36px;
        }

        .small-text {
            font-size: 12px;
            opacity: 0.7;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 16px;
        }

        .dark-mode .form-control {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        /* ===== USER IDENTIFIER STYLES ===== */
        .user-identifier {
            display: inline-block;
            padding: 5px 10px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
            margin-top: 5px;
            color: var(--brand-gold);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .identifier-container {
            margin-top: 10px;
            font-size: 14px;
        }

        .identifier-label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        /* ===== EMPTY STATE STYLES ===== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dark);
        }

        .dark-mode .empty-state {
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: var(--brand-gold);
            opacity: 0.7;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            font-size: 24px;
        }

        .empty-state p {
            margin-bottom: 20px;
            opacity: 0.8;
        }

        /* ===== ENHANCED TRANSACTION STYLES ===== */
        .transaction-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .transaction-tabs {
            border-bottom: 1px solid var(--border-dark);
        }

        .transaction-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .transaction-tab.active {
            border-bottom: 3px solid var(--brand-gold);
            color: var(--brand-gold);
        }

        .transaction-section {
            display: none;
        }

        .transaction-section.active {
            display: block;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-light);
            transition: background 0.3s;
        }

        .dark-mode .transaction-item {
            border-bottom: 1px solid var(--border-dark);
        }

        .transaction-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .dark-mode .transaction-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-type {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .transaction-details {
            font-size: 14px;
            opacity: 0.8;
        }

        .transaction-amount {
            font-weight: 600;
            text-align: right;
        }

        .transaction-date {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .transaction-positive {
            color: var(--success);
        }

        .transaction-negative {
            color: var(--danger);
        }

        .transaction-neutral {
            color: var(--info);
        }
    </style>
</head>
<body>
    <!-- Notification Center -->
    <div class="notification-center" id="notificationCenter"></div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <span class="close-modal">&times;</span>
        <div class="modal-content">
            <img id="modalImage" class="modal-image">
        </div>
    </div>

    <!-- AI Chat Bot -->
    <div id="aiChat" class="ai-chat-container" style="display: none;">
        <div class="ai-chat-header">
            <span>🤖 Nexus AI Assistant</span>
            <button onclick="toggleChat()">−</button>
        </div>
        <div class="ai-chat-body" id="aiChatBody">
            <div class="ai-bot-message">Hello 👋, I'm your Nexus AI Assistant. Ask me about your account, Nexus, or market insights!</div>
        </div>
        <div class="ai-chat-input-area">
            <input type="text" id="aiChatInput" placeholder="Type your question here..." onkeypress="handleChatInput(event)">
            <button onclick="sendAIMessage()">Send</button>
        </div>
    </div>

    <!-- Header (Common for all pages) -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>Nexus Smart Investment</span>
                </div>
                <nav>
                    <ul id="nav-menu">
                        <li><a href="#" class="nav-link active" data-page="home-page">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="about-page">About</a></li>
                        <li><a href="#" class="nav-link" data-page="reviews-page">Reviews</a></li>
                        <li><a href="#" class="nav-link" data-page="contact-page">Contact</a></li>
                        <li><a href="#" class="nav-link" id="login-link">Login</a></li>
                        <li><a href="#" class="btn btn-primary" id="register-link">Get Started</a></li>
                    </ul>
                    <div class="mobile-menu" id="mobile-menu">
                        <i class="fas fa-bars"></i>
                    </div>
                </nav>
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Home Page -->
    <div id="home-page" class="page active">
        <section class="hero">
            <div class="container">
                <h1>Invest with Clarity. Grow with Confidence.</h1>
                <p>A Finland-based investment platform built for long-term thinking, transparent reporting, and global opportunity access.</p>
                <p><strong>Unique Risk Model:</strong> Lower investments carry higher risk, while higher investments enjoy lower risk.</p>
                <div class="hero-btns">
                    <a href="#" class="btn btn-primary" id="hero-register-link">Create Account</a>
                    <a href="#" class="btn btn-secondary" data-page="about-page">Learn More</a>
                </div>
            </div>
        </section>
    </div>

    <!-- About Page -->
    <div id="about-page" class="page">
        <div class="container about-page-content">
            <h2 class="section-title">About Nexus Smart Investment</h2>
            <div class="about-content glass">
                <h3>Our Unique Risk Model</h3>
                <p>Nexus Smart Investment Enterprise introduces a revolutionary approach to investment risk. Unlike traditional models where higher returns typically come with higher risk, our platform operates on an inverse risk principle: lower investment amounts carry higher risk, while larger investments enjoy lower risk. This model is designed to protect our most committed investors while offering potentially higher returns for those willing to accept more risk with smaller amounts.</p>

                <h3>How Our Risk Model Works</h3>
                <p>Our investment structure is carefully calibrated to align risk with investment size. Small investments ($50-$499) are allocated to higher-risk, higher-potential opportunities. Medium investments ($500-$4,999) balance risk and reward with diversified portfolios. Large investments ($5,000-$500,000) benefit from our most secure, carefully vetted opportunities with institutional-level protection. This approach ensures that our most substantial investors receive the security they deserve while smaller investors can access higher-growth potential opportunities.</p>

                <h3>Why This Model Benefits You</h3>
                <p>This unique approach allows investors to strategically manage their risk exposure based on their investment capacity. Beginners can start small with higher potential returns, while experienced investors can scale up with confidence in our most secure offerings. Our transparent reporting ensures you always understand your risk exposure and can make informed decisions about your investment strategy.</p>

                <h3>Security and Transparency</h3>
                <p>Regardless of investment size, all funds are protected by our comprehensive security measures. We maintain transparent reporting standards and provide clear risk assessments for every investment opportunity. Our platform is designed to grow with you, from your first small investment to substantial portfolio management.</p>

                <h3>Global Exposure with Local Stewardship</h3>
                <p>While Nexus operates from Finland, our focus is global. We present opportunities across equities, bonds, and major cryptocurrencies where appropriate, enabling diversified exposure in a single, coherent portfolio. At the same time we maintain local compliance and customer support that is reachable and professional.</p>

                <h3>Long-term Partnership</h3>
                <p>We design for partnership — not transaction. Our success is measured by your long-term outcomes, not short-term sign-ups. That is why we emphasize regular reporting, simple export formats for tax/accounting, and a roadmap shaped by real user feedback. Nexus is here for the investor who values steady compound growth, risk awareness, and the clarity to make disciplined choices.</p>
            </div>
        </div>
    </div>

    <!-- Reviews Page -->
    <div id="reviews-page" class="page">
        <div class="container reviews-page-content">
            <h2 class="section-title">What Our Investors Say</h2>
            
            <!-- Review Form -->
            <div class="review-form-container glass">
                <div class="review-form">
                    <h3>Share Your Experience</h3>
                    <div class="form-group">
                        <label for="reviewer-name">Your Name</label>
                        <input type="text" id="reviewer-name" class="form-control" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Your Rating</label>
                        <div class="rating-input">
                            <span class="rating-star" data-rating="1">★</span>
                            <span class="rating-star" data-rating="2">★</span>
                            <span class="rating-star" data-rating="3">★</span>
                            <span class="rating-star" data-rating="4">★</span>
                            <span class="rating-star" data-rating="5">★</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="review-text">Your Review</label>
                        <textarea id="review-text" class="form-control" placeholder="Share your experience with Nexus Smart Investment..."></textarea>
                    </div>
                    <button class="btn btn-primary" id="submit-review">Submit Review</button>
                </div>
            </div>
            
            <div class="reviews-grid" id="reviewsGrid">
                <!-- Reviews will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Contact Page -->
    <div id="contact-page" class="page">
        <div class="container contact-page-content">
            <h2 class="section-title">Contact Support</h2>
            <div class="contact-form glass">
                <div class="form-group">
                    <label for="contact-name">Your Name</label>
                    <input type="text" id="contact-name" class="form-control" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="contact-email">Your Email</label>
                    <input type="email" id="contact-email" class="form-control" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="contact-message">Message</label>
                    <textarea id="contact-message" class="form-control" placeholder="How can we help you?"></textarea>
                </div>
                <button type="button" class="btn btn-primary" style="width: 100%;" id="contact-submit">Send Message</button>
            </div>
            <div class="contact-info">
                <p><i class="fas fa-envelope"></i> Email: <span class="contact-email" id="contact-email-text">nexussmartinvest@gmail.com</span></p>
                <p><i class="fas fa-map-marker-alt"></i> Location: Finland</p>
            </div>
        </div>
    </div>

    <!-- Login/Register Page -->
    <div id="auth-page" class="page">
        <section class="auth-container">
            <div class="auth-box glass">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">Login</div>
                    <div class="auth-tab" data-tab="register">Register</div>
                </div>

                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                        <span class="password-toggle" id="login-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="login-submit">Login</button>
                </form>

                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" required>
                        <span class="password-toggle" id="reg-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-password">Confirm Password</label>
                        <input type="password" id="reg-confirm-password" class="form-control" required>
                        <span class="password-toggle" id="reg-confirm-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="register-submit">Register</button>
                </form>
            </div>
        </section>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <div class="dashboard-container">
            <div class="sidebar glass">
                <div class="sidebar-header">
                    <div class="sidebar-header-top">
                        <div class="logo">
                            <i class="fas fa-chart-line"></i>
                            <span>Nexus</span>
                        </div>
                    </div>
                    <p>Welcome, <span id="dashboard-username">User</span></p>
                    <div class="identifier-container">
                        <span class="identifier-label">Your Email:</span>
                        <div class="user-identifier" id="dashboard-email">Not Available</div>
                    </div>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" class="dashboard-link active" data-section="overview"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" class="dashboard-link" data-section="transactions"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
                    <li><a href="#" class="dashboard-link" data-section="investment-plans"><i class="fas fa-coins"></i> Investment Plans</a></li>
                    <li><a href="#" class="dashboard-link" data-section="withdraw"><i class="fas fa-arrow-up"></i> Withdraw</a></li>
                    <li><a href="#" class="dashboard-link" data-section="complaint"><i class="fas fa-exclamation-circle"></i> Submit Complaint</a></li>
                    <li><a href="#" class="dashboard-link" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li>
                    <li><a href="#" id="dashboard-logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </div>

            <div class="main-content">
                <!-- Dashboard Overview -->
                <section id="overview" class="dashboard-section active">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Dashboard Overview</h1>
                            <p class="dashboard-subtitle">Welcome back! Here's your investment summary</p>
                        </div>
                        <div class="identifier-container">
                            <span class="identifier-label">Your Email:</span>
                            <div class="user-identifier" id="overview-email">Not Available</div>
                        </div>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <h3>Account Balance</h3>
                            <div class="stat-value" id="account-balance">$0.00</div>
                            <p class="stat-label">Total available funds</p>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Active Investments</h3>
                            <div class="stat-value" id="active-investments">$0.00</div>
                            <p class="stat-label">Currently invested</p>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h3>Total Profit</h3>
                            <div class="stat-value" id="total-profit">$0.00</div>
                            <p class="stat-label">All-time earnings</p>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <h3>Referral Earnings</h3>
                            <div class="stat-value" id="referral-earnings">$0.00</div>
                            <p class="stat-label">From referral program</p>
                        </div>
                    </div>

                    <!-- Referral Program Section -->
                    <div class="dashboard-card">
                        <h3><i class="fas fa-user-plus"></i> Referral Program</h3>
                        <div class="info-row">
                            <span class="info-label">Your Referral Code:</span>
                            <span class="info-value" id="user-referral-code">Loading...</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Your Referral Link:</span>
                            <div style="flex: 1;">
                                <input type="text" id="user-referral-link" readonly 
                                       style="width: 100%; padding: 8px; border: 1px solid var(--border-light); border-radius: 4px; background: var(--card-light);">
                                <button class="btn btn-primary" onclick="copyReferralLink()" style="margin-top: 8px;">
                                    <i class="fas fa-copy"></i> Copy Link
                                </button>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Referrals:</span>
                            <span class="info-value" id="total-referrals">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Referral Earnings:</span>
                            <span class="info-value" id="referral-earnings-display">$0.00</span>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 8px;">
                            <h4><i class="fas fa-gift"></i> How It Works</h4>
                            <p>• Share your referral link with friends</p>
                            <p>• They get 5% bonus on their first deposit</p>
                            <p>• You earn 5% of their first investment</p>
                            <p>• No limit on how many friends you can refer</p>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3><i class="fas fa-user"></i> Account Information</h3>
                            <div class="info-row">
                                <span class="info-label">Username:</span>
                                <span class="info-value" id="overview-username">Not Available</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value" id="overview-email-display">Not Available</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Member Since:</span>
                                <span class="info-value" id="overview-join-date">Not Available</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Last Login:</span>
                                <span class="info-value" id="overview-last-login">Not Available</span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-lightbulb"></i> Nexus Insight of the Week</h3>
                        <p id="weekly-insight">Loading market insight...</p>
                    </div>
                </section>

                <!-- Transactions -->
                <section id="transactions" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Transaction History</h1>
                            <p class="dashboard-subtitle">View and filter your transaction history</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="transaction-tabs">
                            <div class="transaction-tab active" data-tab="all">All Transactions</div>
                            <div class="transaction-tab" data-tab="financial">Financial</div>
                            <div class="transaction-tab" data-tab="activity">Activities</div>
                        </div>
                        
                        <div class="transaction-section active" id="all-transactions">
                            <div id="transaction-history-all">
                                <!-- Transactions will be dynamically generated -->
                            </div>
                        </div>
                        
                        <div class="transaction-section" id="financial-transactions">
                            <div id="transaction-history-financial">
                                <!-- Financial transactions will be dynamically generated -->
                            </div>
                        </div>
                        
                        <div class="transaction-section" id="activity-transactions">
                            <div id="transaction-history-activity">
                                <!-- Activity transactions will be dynamically generated -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Investment Plans (Merged with Deposit) -->
                <section id="investment-plans" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Investment Plans</h1>
                            <p class="dashboard-subtitle">Choose an investment plan that matches your financial goals</p>
                        </div>
                    </div>
                    
                    <div class="investment-deposit-flow">
                        <div class="plan-selection">
                            <div class="plan-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h3>Select Your Investment Plan</h3>
                                    <p>Choose a plan that fits your investment goals</p>
                                </div>
                            </div>
                            
                            <div class="investment-plans">
                                <div class="investment-card glass">
                                    <div class="risk-indicator risk-high">High Risk</div>
                                    <h3>Starter Plan</h3>
                                    <p><strong>Investment Range:</strong> $50 - $499</p>
                                    <p><strong>Potential ROI:</strong> 10-20% monthly</p>
                                    <p><strong>Term:</strong> 3-6 months</p>
                                    <p><strong>Risk:</strong> High (for smaller investments)</p>
                                    <button class="btn btn-primary" onclick="selectPlan('Starter', 50, 'High')">Select Plan</button>
                                </div>

                                <div class="investment-card glass">
                                    <div class="risk-indicator risk-medium">Medium Risk</div>
                                    <h3>Growth Plan</h3>
                                    <p><strong>Investment Range:</strong> $500 - $4,999</p>
                                    <p><strong>Potential ROI:</strong> 6-14% monthly</p>
                                    <p><strong>Term:</strong> 6-12 months</p>
                                    <p><strong>Risk:</strong> Medium (balanced approach)</p>
                                    <button class="btn btn-primary" onclick="selectPlan('Growth', 500, 'Medium')">Select Plan</button>
                                </div>

                                <div class="investment-card glass">
                                    <div class="risk-indicator risk-low">Low Risk</div>
                                    <h3>Premium Plan</h3>
                                    <p><strong>Investment Range:</strong> $5,000 - $500,000</p>
                                    <p><strong>Potential ROI:</strong> 3-9% monthly</p>
                                    <p><strong>Term:</strong> 12-24 months</p>
                                    <p><strong>Risk:</strong> Low (for larger investments)</p>
                                    <button class="btn btn-primary" onclick="selectPlan('Premium', 5000, 'Low')">Select Plan</button>
                                </div>
                            </div>
                        </div>

                        <div id="deposit-section" class="deposit-section">
                            <div class="plan-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h3>Make Your Deposit</h3>
                                    <p>Complete your investment by depositing funds</p>
                                </div>
                            </div>
                            
                            <div id="selected-plan-info" class="selected-plan-info" style="display: none;">
                                <h4>Selected Plan: <span id="selected-plan-name"></span></h4>
                                <p>Minimum Investment: <strong id="selected-plan-amount"></strong></p>
                                <p>Risk Level: <strong id="selected-plan-risk"></strong></p>
                                <button class="btn btn-secondary" onclick="changePlan()">Change Plan</button>
                            </div>
                            
                            <div class="payment-methods">
                                <div class="payment-card glass">
                                    <h3><i class="fab fa-bitcoin"></i> Bitcoin (BTC)</h3>
                                    <p class="wallet-address">bc1qc97mk5j9qgypjprgdps6t24xrqz7xr3at9txhj</p>
                                    <div class="qr-code">
                                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #fff; color: #000;">
                                            BTC QR Code
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="copyToClipboard('bc1qc97mk5j9qgypjprgdps6t24xrqz7xr3at9txhj')">Copy Address</button>
                                </div>

                                <div class="payment-card glass">
                                    <h3><i class="fab fa-ethereum"></i> Ethereum (ERC20)</h3>
                                    <p class="wallet-address">0xCb456E64733Cfe809422f95e7178e566834483F2</p>
                                    <div class="qr-code">
                                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #fff; color: #000;">
                                            ETH QR Code
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="copyToClipboard('0xCb456E64733Cfe809422f95e7178e566834483F2')">Copy Address</button>
                                </div>

                                <div class="payment-card glass">
                                    <h3><i class="fab fa-btc"></i> Binance Coin (BEP20)</h3>
                                    <p class="wallet-address">0xCb456E64733Cfe809422f95e7178e566834483F2</p>
                                    <div class="qr-code">
                                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #fff; color: #000;">
                                            BNB QR Code
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="copyToClipboard('0xCb456E64733Cfe809422f95e7178e566834483F2')">Copy Address</button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <h3><i class="fas fa-check-circle"></i> Confirm Your Deposit</h3>
                                <p>After making your payment, enter the details below so we can log it in your account.</p>
                                <div class="form-group">
                                    <label for="deposit-method">Payment Method</label>
                                    <select id="deposit-method" class="form-control">
                                        <option value="BTC">Bitcoin (BTC)</option>
                                        <option value="ETH">Ethereum (ETH)</option>
                                        <option value="BNB">Binance Coin (BNB)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="deposit-amount">Amount (USD)</label>
                                    <input type="number" id="deposit-amount" class="form-control" placeholder="Enter amount">
                                </div>
                                
                                <!-- Crypto Address Upload Section -->
                                <div class="crypto-address-upload">
                                    <label class="crypto-address-label">Crypto Address Used for Payment</label>
                                    <div class="crypto-address-area" id="crypto-address-area">
                                        <div class="crypto-address-icon">
                                            <i class="fas fa-wallet"></i>
                                        </div>
                                        <div class="crypto-address-text">
                                            <p>Upload a screenshot of the crypto address you used for payment</p>
                                            <p class="small-text">Supported formats: JPG, PNG, GIF (Max: 5MB)</p>
                                        </div>
                                        <div class="crypto-address-btn">Choose File</div>
                                        <input type="file" id="crypto-address-proof" class="crypto-address-input" accept="image/*">
                                    </div>
                                    <div class="crypto-address-preview-container" id="crypto-address-preview-container">
                                        <img id="crypto-address-preview" class="crypto-address-preview">
                                        <button type="button" class="remove-crypto-address" id="remove-crypto-address">Remove Image</button>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" onclick="confirmDeposit()" id="deposit-submit">Confirm Deposit</button>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-calculator"></i> Investment Calculator</h3>
                        <p>Calculate potential returns based on our unique risk model.</p>
                        <div class="form-group">
                            <label for="calc-amount">Investment Amount ($)</label>
                            <input type="number" id="calc-amount" class="form-control" value="1000" min="50" step="50">
                        </div>
                        <div class="form-group">
                            <label for="calc-period">Investment Period (months)</label>
                            <input type="number" id="calc-period" class="form-control" value="12" min="1" max="60">
                        </div>
                        <button class="btn btn-secondary" onclick="calculateInvestment()">Calculate Returns</button>
                        <div id="calc-results" style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 8px; display: none;">
                            <h4>Projected Returns</h4>
                            <p>Risk Level: <span id="calc-risk"></span></p>
                            <p>Estimated Monthly Return: <span id="calc-monthly"></span></p>
                            <p>Total Return: <span id="calc-total"></span></p>
                            <p>Final Balance: <span id="calc-final"></span></p>
                        </div>
                    </div>
                </section>

                <!-- Withdraw -->
                <section id="withdraw" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Withdraw Funds</h1>
                            <p class="dashboard-subtitle">Submit your withdrawal details below</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="form-group">
                            <label for="withdraw-method">Withdrawal Method</label>
                            <select id="withdraw-method" class="form-control">
                                <option value="BTC">Bitcoin (BTC)</option>
                                <option value="ETH">Ethereum (ETH)</option>
                                <option value="BNB">Binance Coin (BNB)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="withdraw-amount">Amount (USD)</label>
                            <input type="number" id="withdraw-amount" class="form-control" placeholder="Enter amount">
                        </div>
                        <div class="form-group">
                            <label for="withdraw-address">Your Wallet Address</label>
                            <input type="text" id="withdraw-address" class="form-control" placeholder="Paste your wallet address">
                        </div>
                        <button class="btn btn-primary" onclick="submitWithdrawal()" id="withdraw-submit">Submit Withdrawal</button>
                    </div>
                </section>

                <!-- Submit Complaint -->
                <section id="complaint" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Submit Complaint</h1>
                            <p class="dashboard-subtitle">Our support team will respond within 24 hours</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="complaint-form">
                            <div class="form-group">
                                <label for="complaint-type">Complaint Type</label>
                                <select id="complaint-type" class="form-control">
                                    <option value="technical">Technical Issue</option>
                                    <option value="transaction">Transaction Problem</option>
                                    <option value="account">Account Issue</option>
                                    <option value="investment">Investment Concern</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="complaint-subject">Subject</label>
                                <input type="text" id="complaint-subject" class="form-control" placeholder="Brief description of your complaint">
                            </div>
                            <div class="form-group">
                                <label for="complaint-message">Detailed Description</label>
                                <textarea id="complaint-message" class="form-control" placeholder="Please provide detailed information about your complaint..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="submitComplaint()" id="complaint-submit">Submit Complaint</button>
                        </div>
                    </div>
                </section>

                <!-- Settings -->
                <section id="settings" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Account Settings</h1>
                            <p class="dashboard-subtitle">Manage your account information and preferences</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="form-group">
                            <label for="settings-name">Full Name</label>
                            <input type="text" id="settings-name" class="form-control" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="settings-username">Username</label>
                            <input type="text" id="settings-username" class="form-control" placeholder="Enter your username">
                        </div>
                        <div class="form-group">
                            <label for="settings-email">Email</label>
                            <input type="email" id="settings-email" class="form-control" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="settings-phone">Phone Number</label>
                            <input type="tel" id="settings-phone" class="form-control" placeholder="Enter your phone number">
                        </div>
                        <div class="form-group">
                            <label for="settings-postal">Postal Code</label>
                            <input type="text" id="settings-postal" class="form-control" placeholder="Enter your postal code">
                        </div>
                        <div class="form-group">
                            <label for="settings-country">Country</label>
                            <input type="text" id="settings-country" class="form-control" placeholder="Enter your country">
                        </div>
                        <div class="form-group">
                            <label for="settings-password">New Password</label>
                            <input type="password" id="settings-password" class="form-control" placeholder="Enter new password">
                            <span class="password-toggle" id="settings-password-toggle">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <div class="form-group">
                            <label for="settings-confirm-password">Confirm New Password</label>
                            <input type="password" id="settings-confirm-password" class="form-control" placeholder="Confirm new password">
                            <span class="password-toggle" id="settings-confirm-password-toggle">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <button class="btn btn-primary" onclick="updateProfile()" id="settings-submit">Update Profile</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer (Common for all pages) -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>Nexus Smart Investment</span>
                </div>
                <div class="footer-links">
                    <a href="#" data-page="home-page">Home</a>
                    <a href="#" data-page="about-page">About</a>
                    <a href="#" data-page="reviews-page">Reviews</a>
                    <a href="#" data-page="contact-page">Contact</a>
                    <a href="#" id="footer-login-link">Login</a>
                </div>
                <p class="copyright">© <span id="current-year">2023</span> Nexus Smart Investment Enterprise. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // ===== GLOBAL VARIABLES =====
        let currentUser = null;
        let userRating = 0;
        let selectedPlan = null;
        let cryptoAddressImage = null;
        let userUnsubscribe = null;
        let transactionsUnsubscribe = null;

        // ===== PAGE MANAGEMENT =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Set current year in footer - changed to 2023 as requested
            document.getElementById('current-year').textContent = '2023';
            
            // Initialize reviews
            renderReviews();
            
            // Check for referral codes in URL
            handleReferralRegistration();
            
            // Check if user is logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showPage('dashboard-page');
                setupRealTimeListeners();
            }
            
            // Initialize rating stars
            initializeRatingStars();
            
            // Initialize review submission
            document.getElementById('submit-review').addEventListener('click', submitReview);
            
            // Initialize crypto address upload functionality
            initializeCryptoAddressUpload();
            
            // Initialize modal functionality
            initializeModal();
            
            // Initialize AI chat toggle
            initializeAIChatToggle();
            
            // Initialize password visibility toggles
            initializePasswordToggles();
            
            // Add email event listeners
            initializeEmailListeners();
            
            // Initialize transaction tabs
            initializeTransactionTabs();
            
            // Check auth state
            window.onAuthStateChanged(window.firebaseAuth, (user) => {
                if (user) {
                    // User is signed in
                    if (!currentUser) {
                        // Fetch user data from Firestore using email as document ID
                        fetchUserData(user.email);
                    }
                } else {
                    // User is signed out
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    
                    // Unsubscribe from real-time listeners
                    if (userUnsubscribe) userUnsubscribe();
                    if (transactionsUnsubscribe) transactionsUnsubscribe();
                    
                    // Show login page
                    showPage('home-page');
                }
            });
        });

        // Initialize transaction tabs
        function initializeTransactionTabs() {
            const tabs = document.querySelectorAll('.transaction-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    document.querySelectorAll('.transaction-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    document.getElementById(`${tabName}-transactions`).classList.add('active');
                    
                    // Update the displayed transactions
                    updateTransactionHistory();
                });
            });
        }

        // Fetch user data using email as document ID
        async function fetchUserData(email) {
            try {
                // Use email as document ID for easy tracking
                const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", email));
                if (userDoc.exists()) {
                    currentUser = userDoc.data();
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showPage('dashboard-page');
                    setupRealTimeListeners();
                    loadUserSettings();
                } else {
                    console.log("No user document found with email:", email);
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }

        function setupRealTimeListeners() {
            if (!currentUser) return;
            
            // Set up real-time listener for user data using email as document ID
            userUnsubscribe = window.firebaseOnSnapshot(
                window.firebaseDoc(window.firebaseDb, "users", currentUser.email),
                (doc) => {
                    if (doc.exists()) {
                        currentUser = doc.data();
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        updateDashboard();
                    }
                }
            );
            
            // Set up real-time listener for transactions using email for tracking
            transactionsUnsubscribe = window.firebaseOnSnapshot(
                window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    window.firebaseWhere("userEmail", "==", currentUser.email),
                    window.firebaseOrderBy("createdAt", "desc")
                ),
                (snapshot) => {
                    updateTransactionHistory();
                }
            );
        }

        function initializeApp() {
            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            
            const toggleTheme = () => {
                document.body.classList.toggle('dark-mode');
                
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('nexusTheme', isDark ? 'dark' : 'light');
                
                const icon = isDark ? 'fa-sun' : 'fa-moon';
                themeToggle.innerHTML = `<i class="fas ${icon}"></i>`;
            };
            
            themeToggle.addEventListener('click', toggleTheme);
            
            // Set initial theme
            const savedTheme = localStorage.getItem('nexusTheme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    if (page) {
                        showPage(page);
                    }
                    
                    // Close mobile menu if open
                    document.getElementById('nav-menu').classList.remove('show');
                });
            });
            
            // Footer navigation
            document.querySelectorAll('.footer-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    if (page) {
                        showPage(page);
                    }
                });
            });
            
            // Auth links
            document.getElementById('login-link').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('auth-page');
            });
            
            document.getElementById('register-link').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('auth-page');
                switchAuthTab('register');
            });
            
            document.getElementById('hero-register-link').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('auth-page');
                switchAuthTab('register');
            });
            
            document.getElementById('footer-login-link').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('auth-page');
            });
            
            // Auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchAuthTab(tabName);
                });
            });
            
            // Auth forms
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                loginUser();
            });
            
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                registerUser();
            });
            
            // Dashboard navigation
            document.querySelectorAll('.dashboard-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchDashboardSection(section);
                });
            });
            
            // Dashboard logout
            document.getElementById('dashboard-logout').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // Contact form
            document.getElementById('contact-submit').addEventListener('click', function() {
                submitContactForm();
            });
            
            // Mobile menu
            document.getElementById('mobile-menu').addEventListener('click', function() {
                document.getElementById('nav-menu').classList.toggle('show');
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (navLink) {
                navLink.classList.add('active');
            }
            
            // Log page view
            logUserActivity('page_view', `Navigated to ${pageId}`, pageId);
        }

        function switchAuthTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.auth-tab[data-tab="${tabName}"]`).classList.add('active');
            
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        function switchDashboardSection(sectionId) {
            document.querySelectorAll('.dashboard-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.dashboard-link[data-section="${sectionId}"]`).classList.add('active');
            
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');

            if (sectionId === 'settings') {
                loadUserSettings();
            } else if (sectionId === 'transactions') {
                updateTransactionHistory();
            }
        }

        // ===== FIREBASE AUTHENTICATION =====
        async function registerUser() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            
            if (!fullName || !email || !username || !password) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('register-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create user with Firebase Auth
                const userCredential = await window.firebaseCreateUser(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                // Check for referral code
                const referralCode = sessionStorage.getItem('pendingReferral');
                let referrerId = null;
                
                if (referralCode) {
                    // Find the user with this referral code
                    const usersRef = window.firebaseCollection(window.firebaseDb, "users");
                    const q = window.firebaseQuery(usersRef, window.firebaseWhere("referralCode", "==", referralCode));
                    const querySnapshot = await window.firebaseGetDocs(q);
                    
                    if (!querySnapshot.empty) {
                        referrerId = querySnapshot.docs[0].id; // This will be the email
                    }
                }
                
                // Create user data object
                const userData = {
                    id: user.uid,
                    fullName: fullName,
                    email: email,
                    username: username,
                    balance: 0,
                    activeInvestments: 0,
                    totalProfit: 0,
                    referralEarnings: 0,
                    joined: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    referralCode: generateReferralCode(),
                    referralLink: getReferralLink(generateReferralCode()),
                    referrals: [],
                    referredBy: referrerId,
                    phone: '',
                    postal: '',
                    country: '',
                    createdAt: window.firebaseServerTimestamp()
                };
                
                // Save user data to Firestore using email as document ID for easy tracking
                await window.firebaseSetDoc(window.firebaseDoc(window.firebaseDb, "users", email), userData);
                
                // If referred by someone, update their referrals
                if (referrerId) {
                    await window.firebaseUpdateDoc(
                        window.firebaseDoc(window.firebaseDb, "users", referrerId),
                        {
                            referrals: window.firebaseIncrement(1)
                        }
                    );
                    
                    // Create referral record
                    await window.firebaseAddDoc(
                        window.firebaseCollection(window.firebaseDb, "referrals"),
                        {
                            referrerId: referrerId,
                            referredUserId: email,
                            referredEmail: email,
                            status: 'pending',
                            bonusAmount: 0,
                            createdAt: window.firebaseServerTimestamp()
                        }
                    );
                    
                    sessionStorage.removeItem('pendingReferral');
                }
                
                // Set current user and update UI
                currentUser = userData;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showNotification('Registration successful!', 'success');
                showPage('dashboard-page');
                setupRealTimeListeners();
                
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Registration failed: ' + error.message, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Please enter email and password', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('login-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Sign in with Firebase Auth
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                // Get user data from Firestore using email as document ID
                const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, email));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userData.lastLogin = new Date().toISOString();
                    
                    // Update last login in Firestore
                    await window.firebaseSetDoc(window.firebaseDoc(window.firebaseDb, "users", email), userData, { merge: true });
                    
                    // Set current user and update UI
                    currentUser = userData;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showNotification(`Welcome back, ${userData.fullName.split(' ')[0]}!`, 'success');
                    showPage('dashboard-page');
                    setupRealTimeListeners();
                } else {
                    showNotification('User data not found', 'error');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Login failed: ' + error.message, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function logout() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // Unsubscribe from real-time listeners
                if (userUnsubscribe) userUnsubscribe();
                if (transactionsUnsubscribe) transactionsUnsubscribe();
                
                showNotification('You have been logged out', 'info');
                showPage('home-page');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Logout failed', 'error');
            }
        }

        // ===== ACTIVITY LOGGING =====
        async function logUserActivity(eventType, details = '', page = '', additionalData = {}) {
            if (!currentUser) return;
            
            try {
                const activityData = {
                    userId: currentUser.id,
                    userEmail: currentUser.email,
                    username: currentUser.username,
                    eventType: eventType,
                    details: details,
                    page: page,
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString(),
                    createdAt: window.firebaseServerTimestamp(),
                    ...additionalData
                };

                // Save to Firestore transactions collection as an activity
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    {
                        ...activityData,
                        type: 'activity',
                        amount: 0
                    }
                );
                
                // Also save to local storage for offline access
                saveTransactionToLocalStorage({
                    ...activityData,
                    type: 'activity',
                    amount: 0
                });
                
                return { status: 'success', message: 'Activity logged' };
            } catch (error) {
                console.error('Failed to log activity:', error);
                return { status: 'error', message: 'Failed to log activity' };
            }
        }

        // ===== TRANSACTION MANAGEMENT =====
        // Save transaction to local storage
        function saveTransactionToLocalStorage(transaction) {
            if (!currentUser) return;
            
            const userTransactions = JSON.parse(localStorage.getItem(`nexusTransactions_${currentUser.email}`)) || [];
            userTransactions.push(transaction);
            localStorage.setItem(`nexusTransactions_${currentUser.email}`, JSON.stringify(userTransactions));
        }

        // Get transactions from local storage
        function getTransactionsFromLocalStorage() {
            if (!currentUser) return [];
            
            return JSON.parse(localStorage.getItem(`nexusTransactions_${currentUser.email}`)) || [];
        }

        // Get all transactions (Firestore + Local Storage)
        async function getAllTransactions() {
            let transactions = [];
            
            // Get from Firestore
            try {
                const q = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    window.firebaseWhere("userEmail", "==", currentUser.email),
                    window.firebaseOrderBy("createdAt", "desc")
                );
                
                const querySnapshot = await window.firebaseGetDocs(q);
                querySnapshot.forEach((doc) => {
                    transactions.push(doc.data());
                });
            } catch (error) {
                console.error('Error fetching transactions from Firestore:', error);
            }
            
            // Get from local storage
            const localTransactions = getTransactionsFromLocalStorage();
            
            // Merge and remove duplicates by id
            const allTransactions = [...transactions];
            localTransactions.forEach(localT => {
                if (!allTransactions.find(t => t.id === localT.id)) {
                    allTransactions.push(localT);
                }
            });
            
            // Sort by date, most recent first
            allTransactions.sort((a, b) => {
                const dateA = a.createdAt?.toDate?.() || new Date(a.timestamp || a.date);
                const dateB = b.createdAt?.toDate?.() || new Date(b.timestamp || b.date);
                return dateB - dateA;
            });
            
            return allTransactions;
        }

        // Display transactions in the UI
        async function updateTransactionHistory() {
            if (!currentUser) return;
            
            const allTransactions = await getAllTransactions();
            displayTransactionHistory(allTransactions);
        }

        function displayTransactionHistory(transactions) {
            // Get active tab
            const activeTab = document.querySelector('.transaction-tab.active');
            const tabType = activeTab ? activeTab.getAttribute('data-tab') : 'all';
            
            // Filter transactions based on active tab
            let filteredTransactions = transactions;
            if (tabType === 'financial') {
                filteredTransactions = transactions.filter(t => t.type !== 'activity');
            } else if (tabType === 'activity') {
                filteredTransactions = transactions.filter(t => t.type === 'activity');
            }
            
            // Display in appropriate container
            const containerId = `${tabType}-transactions`;
            const container = document.getElementById(`transaction-history-${tabType}`);
            
            if (!container) return;
            
            if (filteredTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3>No Transactions Yet</h3>
                        <p>Your transaction history will appear here once you start making transactions.</p>
                        ${tabType === 'all' || tabType === 'financial' ? 
                            '<a href="#" class="btn btn-primary" data-section="investment-plans">Make Your First Deposit</a>' : 
                            ''}
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredTransactions.forEach(transaction => {
                const date = new Date(transaction.createdAt?.toDate?.() || transaction.timestamp || transaction.date).toLocaleDateString();
                const time = new Date(transaction.createdAt?.toDate?.() || transaction.timestamp || transaction.date).toLocaleTimeString();
                
                let type = transaction.type;
                let amount = formatCurrency(transaction.amount || 0);
                let details = transaction.details || '';
                let status = transaction.status || 'completed';
                
                // Determine color class based on transaction type and amount
                let amountClass = 'transaction-neutral';
                if (type === 'deposit' || type === 'investment' || type === 'referral') {
                    amountClass = 'transaction-positive';
                } else if (type === 'withdrawal') {
                    amountClass = 'transaction-negative';
                }
                
                // Format transaction type for display
                let displayType = type.charAt(0).toUpperCase() + type.slice(1);
                if (type === 'activity') {
                    displayType = 'Activity';
                    amountClass = 'transaction-neutral';
                    amount = '';
                }
                
                html += `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-type">${displayType}</div>
                            <div class="transaction-details">${details}</div>
                            <div class="transaction-date">${date} at ${time}</div>
                        </div>
                        <div class="transaction-amount ${amountClass}">
                            ${amount}
                            ${status !== 'completed' ? `<div class="small-text">${status}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ===== EMAIL EVENT LISTENERS =====
        function initializeEmailListeners() {
            // Contact page email
            const contactEmail = document.getElementById('contact-email-text');
            if (contactEmail) {
                contactEmail.addEventListener('click', function() {
                    window.location.href = 'mailto:nexussmartinvest@gmail.com';
                });
            }
            
            // AI chat bot mentions of email
            document.addEventListener('click', function(e) {
                if (e.target && e.target.textContent && e.target.textContent.includes('nexussmartinvest@gmail.com')) {
                    window.location.href = 'mailto:nexussmartinvest@gmail.com';
                }
            });
        }

        // ===== PASSWORD TOGGLE FUNCTIONALITY =====
        function initializePasswordToggles() {
            // Login form
            const loginPasswordToggle = document.getElementById('login-password-toggle');
            const loginPasswordInput = document.getElementById('login-password');
            
            if (loginPasswordToggle && loginPasswordInput) {
                loginPasswordToggle.addEventListener('click', function() {
                    togglePasswordVisibility(loginPasswordInput, loginPasswordToggle);
                });
            }
            
            // Registration form
            const regPasswordToggle = document.getElementById('reg-password-toggle');
            const regPasswordInput = document.getElementById('password');
            
            if (regPasswordToggle && regPasswordInput) {
                regPasswordToggle.addEventListener('click', function() {
                    togglePasswordVisibility(regPasswordInput, regPasswordToggle);
                });
            }
            
            const regConfirmPasswordToggle = document.getElementById('reg-confirm-password-toggle');
            const regConfirmPasswordInput = document.getElementById('reg-confirm-password');
            
            if (regConfirmPasswordToggle && regConfirmPasswordInput) {
                regConfirmPasswordToggle.addEventListener('click', function() {
                    togglePasswordVisibility(regConfirmPasswordInput, regConfirmPasswordToggle);
                });
            }
            
            // Settings form
            const settingsPasswordToggle = document.getElementById('settings-password-toggle');
            const settingsPasswordInput = document.getElementById('settings-password');
            
            if (settingsPasswordToggle && settingsPasswordInput) {
                settingsPasswordToggle.addEventListener('click', function() {
                    togglePasswordVisibility(settingsPasswordInput, settingsPasswordToggle);
                });
            }
            
            const settingsConfirmPasswordToggle = document.getElementById('settings-confirm-password-toggle');
            const settingsConfirmPasswordInput = document.getElementById('settings-confirm-password');
            
            if (settingsConfirmPasswordToggle && settingsConfirmPasswordInput) {
                settingsConfirmPasswordToggle.addEventListener('click', function() {
                    togglePasswordVisibility(settingsConfirmPasswordInput, settingsConfirmPasswordToggle);
                });
            }
        }

        function togglePasswordVisibility(passwordInput, toggleIcon) {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Toggle eye icon
            if (type === 'text') {
                toggleIcon.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                toggleIcon.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        // ===== REFERRAL SYSTEM =====
        function generateReferralCode() {
            return `NEXUS-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;
        }

        function getReferralLink(referralCode) {
            const baseUrl = window.location.origin + window.location.pathname;
            return `${baseUrl}?ref=${referralCode}`;
        }

        function handleReferralRegistration() {
            const urlParams = new URLSearchParams(window.location.search);
            const referralCode = urlParams.get('ref');
            
            if (referralCode) {
                // Store referral in session for tracking
                sessionStorage.setItem('pendingReferral', referralCode);
                
                showNotification(`Referral code applied: ${referralCode}`, 'info');
            }
        }

        // ===== DASHBOARD REFERRAL FUNCTIONS =====
        function updateReferralInfo() {
            if (!currentUser) return;
            
            document.getElementById('user-referral-code').textContent = currentUser.referralCode || 'Not available';
            document.getElementById('user-referral-link').value = currentUser.referralLink || 'Not available';
            
            // Calculate referral stats
            const totalReferrals = currentUser.referrals || 0;
            const referralEarnings = currentUser.referralEarnings || 0;
            
            document.getElementById('total-referrals').textContent = totalReferrals;
            document.getElementById('referral-earnings-display').textContent = formatCurrency(referralEarnings);
        }

        function copyReferralLink() {
            const referralLink = document.getElementById('user-referral-link');
            referralLink.select();
            document.execCommand('copy');
            
            showNotification('Referral link copied to clipboard!', 'success');
        }

        // ===== CRYPTO ADDRESS UPLOAD FUNCTIONALITY =====
        function initializeCryptoAddressUpload() {
            const fileInput = document.getElementById('crypto-address-proof');
            const cryptoAddressArea = document.getElementById('crypto-address-area');
            const previewContainer = document.getElementById('crypto-address-preview-container');
            const imagePreview = document.getElementById('crypto-address-preview');
            const removeImageBtn = document.getElementById('remove-crypto-address');
            
            if (!fileInput || !cryptoAddressArea) return;
            
            // Click on upload area to trigger file input
            cryptoAddressArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // File input change event
            fileInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    // Check file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('Image size must be less than 5MB', 'error');
                        this.value = '';
                        return;
                    }
                    
                    // Check file type
                    if (!file.type.match('image.*')) {
                        showNotification('Please select an image file', 'error');
                        this.value = '';
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        previewContainer.classList.add('active');
                        cryptoAddressArea.classList.add('active');
                        cryptoAddressImage = e.target.result;
                    }
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // Remove image
            removeImageBtn.addEventListener('click', function() {
                fileInput.value = '';
                previewContainer.classList.remove('active');
                cryptoAddressArea.classList.remove('active');
                cryptoAddressImage = null;
            });
            
            // Drag and drop functionality
            cryptoAddressArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                cryptoAddressArea.classList.add('active');
            });
            
            cryptoAddressArea.addEventListener('dragleave', function() {
                cryptoAddressArea.classList.remove('active');
            });
            
            cryptoAddressArea.addEventListener('drop', function(e) {
                e.preventDefault();
                cryptoAddressArea.classList.remove('active');
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    const file = e.dataTransfer.files[0];
                    
                    // Check file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('Image size must be less than 5MB', 'error');
                        return;
                    }
                    
                    // Check file type
                    if (!file.type.match('image.*')) {
                        showNotification('Please select an image file', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        previewContainer.classList.add('active');
                        cryptoAddressArea.classList.add('active');
                        cryptoAddressImage = e.target.result;
                    }
                    
                    reader.readAsDataURL(file);
                }
            });
        }

        // ===== MODAL FUNCTIONALITY =====
        function initializeModal() {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const closeModal = document.querySelector('.close-modal');
            
            if (!modal || !closeModal) return;
            
            // Close modal when clicking the X
            closeModal.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Close modal when clicking outside the image
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    modal.style.display = 'none';
                }
            });
        }

        function showImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            
            if (!modal || !modalImage) return;
            
            modalImage.src = imageSrc;
            modal.style.display = 'block';
        }

        // ===== USER SETTINGS FUNCTIONS =====
        function loadUserSettings() {
            if (!currentUser) return;
            
            document.getElementById('settings-name').value = currentUser.fullName || '';
            document.getElementById('settings-username').value = currentUser.username || '';
            document.getElementById('settings-email').value = currentUser.email || '';
            document.getElementById('settings-phone').value = currentUser.phone || '';
            document.getElementById('settings-postal').value = currentUser.postal || '';
            document.getElementById('settings-country').value = currentUser.country || '';
            
            document.getElementById('settings-password').value = '';
            document.getElementById('settings-confirm-password').value = '';
        }

        async function updateProfile() {
            if (!currentUser) {
                showNotification('Please login to update profile', 'error');
                return;
            }
            
            const name = document.getElementById('settings-name').value;
            const username = document.getElementById('settings-username').value;
            const email = document.getElementById('settings-email').value;
            const phone = document.getElementById('settings-phone').value;
            const postal = document.getElementById('settings-postal').value;
            const country = document.getElementById('settings-country').value;
            const password = document.getElementById('settings-password').value;
            const confirmPassword = document.getElementById('settings-confirm-password').value;
            
            if (password && password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Update current user object
            const updatedUser = {
                ...currentUser,
                fullName: name,
                username: username,
                email: email,
                phone: phone,
                postal: postal,
                country: country
            };
            
            try {
                // Update in Firestore using email as document ID
                await window.firebaseSetDoc(
                    window.firebaseDoc(window.firebaseDb, "users", currentUser.email), 
                    updatedUser, 
                    { merge: true }
                );
                
                // Update current user
                currentUser = updatedUser;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showNotification('Profile updated successfully!', 'success');
                
                // Update dashboard
                updateDashboard();
                
                logUserActivity('profile_updated', 'User updated their profile information', 'settings');
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Failed to update profile', 'error');
            }
        }

        // ===== REVIEW SYSTEM =====
        function initializeRatingStars() {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    setRating(rating);
                });
                
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    highlightStars(rating);
                });
            });
            
            const ratingInput = document.querySelector('.rating-input');
            if (ratingInput) {
                ratingInput.addEventListener('mouseleave', function() {
                    highlightStars(userRating);
                });
            }
        }

        function setRating(rating) {
            userRating = rating;
            highlightStars(rating);
        }

        function highlightStars(rating) {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach(star => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function submitReview() {
            const name = document.getElementById('reviewer-name').value;
            const text = document.getElementById('review-text').value;
            
            if (!name || !text) {
                showNotification('Please enter your name and review', 'error');
                return;
            }
            
            if (userRating === 0) {
                showNotification('Please select a rating', 'error');
                return;
            }
            
            const review = {
                id: Date.now(),
                name: name,
                date: new Date().toISOString(),
                rating: userRating,
                text: text,
                avatar: `https://i.pravatar.cc/150?u=${Date.now()}`
            };
            
            const userReviews = JSON.parse(localStorage.getItem('nexusUserReviews')) || [];
            userReviews.push(review);
            localStorage.setItem('nexusUserReviews', JSON.stringify(userReviews));
            
            showNotification('Thank you for your review!', 'success');
            
            document.getElementById('reviewer-name').value = '';
            document.getElementById('review-text').value = '';
            setRating(0);
            
            renderReviews();
        }

        function renderReviews() {
            // Removed Amina Khan review as requested
            const staticReviews = [
                {"name":"Daniel Korhonen","date":"2024-11-22","rating":4.7,"text":"I appreciate the lower risk with my larger investments.","avatar":"https://i.pravatar.cc/150?img=2"},
                {"name":"Sophia Silva","date":"2025-01-10","rating":4.9,"text":"The risk-adjusted returns are exactly what I was looking for.","avatar":"https://i.pravatar.cc/150?img=3"},
                {"name":"Liam Olsen","date":"2024-12-03","rating":4.6,"text":"Higher risk for smaller amounts gives me a chance to grow faster.","avatar":"https://i.pravatar.cc/150?img=4"},
                {"name":"Olivia Nguyen","date":"2024-08-19","rating":4.8,"text":"Perfect for diversifying my portfolio with different risk levels.","avatar":"https://i.pravatar.cc/150?img=5"},
                {"name":"Noah Ivanov","date":"2025-05-12","rating":5,"text":"The inverse risk model is revolutionary in investment platforms.","avatar":"https://i.pravatar.cc/150?img=6"},
                {"name":"Emilia Adedeji","date":"2024-10-02","rating":4.5,"text":"Finally a platform that understands different investor needs.","avatar":"https://i.pravatar.cc/150?img=7"},
                {"name":"Ethan Mendes","date":"2025-02-28","rating":4.8,"text":"My larger investments feel much more secure with the lower risk.","avatar":"https://i.pravatar.cc/150?img=8"},
                {"name":"Marta Popov","date":"2024-07-15","rating":4.4,"text":"The risk indicators make it easy to understand my exposure.","avatar":"https://i.pravatar.cc/150?img=9"},
                {"name":"Jonas Jensen","date":"2024-09-08","rating":4.7,"text":"Perfect balance between risk and potential returns.","avatar":"https://i.pravatar.cc/150?img=10"}
            ];
            
            const userReviews = JSON.parse(localStorage.getItem('nexusUserReviews')) || [];
            const allReviews = [...userReviews, ...staticReviews];
            allReviews.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const reviewsGrid = document.getElementById('reviewsGrid');
            let html = '';
            
            allReviews.forEach(review => {
                const date = new Date(review.date).toLocaleDateString();
                let stars = '';
                
                for (let i = 1; i <= 5; i++) {
                    if (i <= Math.floor(review.rating)) {
                        stars += '<i class="fas fa-star"></i>';
                    } else if (i - 0.5 <= review.rating) {
                        stars += '<i class="fas fa-star-half-alt"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                
                html += `
                    <div class="review-card">
                        <div class="review-header">
                            <img src="${review.avatar}" alt="${review.name}" class="review-avatar">
                            <div>
                                <div class="review-name">${review.name}</div>
                                <div class="review-rating">${stars} <span>${review.rating}</span></div>
                            </div>
                        </div>
                        <div class="review-text">${review.text}</div>
                        <div class="review-date">${date}</div>
                    </div>
                `;
            });
            
            reviewsGrid.innerHTML = html;
        }

        // ===== NOTIFICATION SYSTEM =====
        function showNotification(message, type = 'info') {
            const notificationCenter = document.getElementById('notificationCenter');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            else if (type === 'warning') icon = 'exclamation-triangle';
            else if (type === 'error') icon = 'exclamation-circle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            notificationCenter.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // ===== DASHBOARD UPDATE FUNCTIONS =====
        function updateDashboard() {
            if (!currentUser) return;
            
            // Update user information
            document.getElementById('dashboard-username').textContent = currentUser.fullName || currentUser.username || 'User';
            document.getElementById('dashboard-email').textContent = currentUser.email || 'Not Available';
            document.getElementById('overview-email').textContent = currentUser.email || 'Not Available';
            document.getElementById('overview-username').textContent = currentUser.username || 'Not Available';
            document.getElementById('overview-email-display').textContent = currentUser.email || 'Not Available';
            document.getElementById('overview-join-date').textContent = currentUser.joined ? new Date(currentUser.joined).toLocaleDateString() : 'Not Available';
            document.getElementById('overview-last-login').textContent = currentUser.lastLogin ? new Date(currentUser.lastLogin).toLocaleDateString() : 'Not Available';
            
            // Update account stats
            document.getElementById('account-balance').textContent = formatCurrency(currentUser.balance || 0);
            document.getElementById('active-investments').textContent = formatCurrency(currentUser.activeInvestments || 0);
            document.getElementById('total-profit').textContent = formatCurrency(currentUser.totalProfit || 0);
            document.getElementById('referral-earnings').textContent = formatCurrency(currentUser.referralEarnings || 0);
            
            // Update referral info
            updateReferralInfo();
            
            // Update weekly insight
            updateWeeklyInsight();
        }

        function updateWeeklyInsight() {
            const insights = [
                "Market volatility presents opportunities for strategic investors. Consider dollar-cost averaging.",
                "Our inverse risk model ensures larger investments maintain stability while smaller investments pursue growth.",
                "Diversification remains key to long-term investment success. Explore our multi-tier investment plans.",
                "Cryptocurrency markets are showing signs of recovery. Monitor Bitcoin and Ethereum for entry points.",
                "With inflation concerns, consider assets with intrinsic value like commodities and real estate.",
                "The AI assistant can provide personalized investment advice based on your portfolio and goals."
            ];
            
            const randomInsight = insights[Math.floor(Math.random() * insights.length)];
            document.getElementById('weekly-insight').textContent = randomInsight;
        }

        // ===== INVESTMENT PLANS =====
        function selectPlan(planName, minAmount, riskLevel) {
            selectedPlan = {
                name: planName,
                minAmount: minAmount,
                riskLevel: riskLevel
            };
            
            // Show selected plan info
            document.getElementById('selected-plan-name').textContent = planName;
            document.getElementById('selected-plan-amount').textContent = formatCurrency(minAmount);
            document.getElementById('selected-plan-risk').textContent = riskLevel;
            document.getElementById('selected-plan-info').style.display = 'block';
            
            // Show deposit section
            document.getElementById('deposit-section').classList.add('active');
            
            // Scroll to deposit section
            document.getElementById('deposit-section').scrollIntoView({ behavior: 'smooth' });
            
            // Log activity
            logUserActivity('plan_selected', `Selected ${planName} plan`, 'investment-plans', {
                planName: planName,
                minAmount: minAmount,
                riskLevel: riskLevel
            });
        }

        function changePlan() {
            selectedPlan = null;
            document.getElementById('selected-plan-info').style.display = 'none';
            document.getElementById('deposit-section').classList.remove('active');
        }

        // ===== DEPOSIT FUNCTIONS =====
        async function confirmDeposit() {
            if (!currentUser) {
                showNotification('Please login to make a deposit', 'error');
                return;
            }
            
            if (!selectedPlan) {
                showNotification('Please select an investment plan first', 'error');
                return;
            }
            
            const method = document.getElementById('deposit-method').value;
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            
            if (!amount || amount < selectedPlan.minAmount) {
                showNotification(`Minimum deposit for ${selectedPlan.name} plan is ${formatCurrency(selectedPlan.minAmount)}`, 'error');
                return;
            }
            
            if (!cryptoAddressImage) {
                showNotification('Please upload a screenshot of the crypto address used for payment', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('deposit-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create transaction record
                const transactionId = Date.now().toString();
                const transactionData = {
                    id: transactionId,
                    userId: currentUser.id,
                    userEmail: currentUser.email,
                    username: currentUser.username,
                    type: 'deposit',
                    amount: amount,
                    method: method,
                    plan: selectedPlan.name,
                    riskLevel: selectedPlan.riskLevel,
                    cryptoAddressImage: cryptoAddressImage,
                    status: 'pending',
                    date: new Date().toISOString(),
                    createdAt: window.firebaseServerTimestamp()
                };
                
                // Save to Firestore
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    transactionData
                );
                
                // Also save to local storage
                saveTransactionToLocalStorage(transactionData);
                
                // Show success message
                showNotification(`Deposit of ${formatCurrency(amount)} submitted successfully!`, 'success');
                
                // Reset form
                document.getElementById('deposit-amount').value = '';
                document.getElementById('crypto-address-proof').value = '';
                document.getElementById('crypto-address-preview-container').classList.remove('active');
                document.getElementById('crypto-address-area').classList.remove('active');
                cryptoAddressImage = null;
                
                // Log activity
                logUserActivity('deposit_submitted', `Deposited ${formatCurrency(amount)} for ${selectedPlan.name} plan`, 'investment-plans', {
                    amount: amount,
                    plan: selectedPlan.name,
                    method: method
                });
                
            } catch (error) {
                console.error('Error submitting deposit:', error);
                showNotification('Failed to submit deposit', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== WITHDRAWAL FUNCTIONS =====
        async function submitWithdrawal() {
            if (!currentUser) {
                showNotification('Please login to make a withdrawal', 'error');
                return;
            }
            
            const method = document.getElementById('withdraw-method').value;
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const address = document.getElementById('withdraw-address').value;
            
            if (!amount || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            if (!address) {
                showNotification('Please enter your wallet address', 'error');
                return;
            }
            
            if (amount > (currentUser.balance || 0)) {
                showNotification('Insufficient balance for this withdrawal', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('withdraw-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create transaction record
                const transactionId = Date.now().toString();
                const transactionData = {
                    id: transactionId,
                    userId: currentUser.id,
                    userEmail: currentUser.email,
                    username: currentUser.username,
                    type: 'withdrawal',
                    amount: amount,
                    method: method,
                    address: address,
                    status: 'pending',
                    date: new Date().toISOString(),
                    createdAt: window.firebaseServerTimestamp()
                };
                
                // Save to Firestore
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    transactionData
                );
                
                // Also save to local storage
                saveTransactionToLocalStorage(transactionData);
                
                // Update user balance in Firestore
                const newBalance = (currentUser.balance || 0) - amount;
                await window.firebaseUpdateDoc(
                    window.firebaseDoc(window.firebaseDb, "users", currentUser.email),
                    {
                        balance: newBalance
                    }
                );
                
                // Update local user data
                currentUser.balance = newBalance;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Show success message
                showNotification(`Withdrawal of ${formatCurrency(amount)} submitted successfully!`, 'success');
                
                // Reset form
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('withdraw-address').value = '';
                
                // Update dashboard
                updateDashboard();
                
                // Log activity
                logUserActivity('withdrawal_submitted', `Requested withdrawal of ${formatCurrency(amount)}`, 'withdraw', {
                    amount: amount,
                    method: method,
                    address: address
                });
                
            } catch (error) {
                console.error('Error submitting withdrawal:', error);
                showNotification('Failed to submit withdrawal', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== COMPLAINT FUNCTIONS =====
        async function submitComplaint() {
            if (!currentUser) {
                showNotification('Please login to submit a complaint', 'error');
                return;
            }
            
            const type = document.getElementById('complaint-type').value;
            const subject = document.getElementById('complaint-subject').value;
            const message = document.getElementById('complaint-message').value;
            
            if (!subject || !message) {
                showNotification('Please enter subject and message', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('complaint-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create complaint record
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "complaints"),
                    {
                        userId: currentUser.id,
                        userEmail: currentUser.email,
                        username: currentUser.username,
                        type: type,
                        subject: subject,
                        message: message,
                        status: 'open',
                        date: new Date().toISOString(),
                        createdAt: window.firebaseServerTimestamp()
                    }
                );
                
                // Show success message
                showNotification('Complaint submitted successfully! We will respond within 24 hours.', 'success');
                
                // Reset form
                document.getElementById('complaint-subject').value = '';
                document.getElementById('complaint-message').value = '';
                
                // Log activity
                logUserActivity('complaint_submitted', `Submitted complaint: ${subject}`, 'complaint', {
                    type: type,
                    subject: subject
                });
                
            } catch (error) {
                console.error('Error submitting complaint:', error);
                showNotification('Failed to submit complaint', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== CONTACT FORM =====
        async function submitContactForm() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;
            
            if (!name || !email || !message) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('contact-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create contact message record
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "contact_messages"),
                    {
                        name: name,
                        email: email,
                        message: message,
                        date: new Date().toISOString(),
                        createdAt: window.firebaseServerTimestamp()
                    }
                );
                
                // Show success message
                showNotification('Message sent successfully! We will respond within 24 hours.', 'success');
                
                // Reset form
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-email').value = '';
                document.getElementById('contact-message').value = '';
                
                // Log activity
                logUserActivity('contact_form_submitted', 'Submitted contact form', 'contact', {
                    name: name,
                    email: email
                });
                
            } catch (error) {
                console.error('Error submitting contact form:', error);
                showNotification('Failed to send message', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== INVESTMENT CALCULATOR =====
        function calculateInvestment() {
            const amount = parseFloat(document.getElementById('calc-amount').value);
            const period = parseInt(document.getElementById('calc-period').value);
            
            if (!amount || amount < 50 || !period || period < 1) {
                showNotification('Please enter valid investment amount and period', 'error');
                return;
            }
            
            let riskLevel, monthlyReturn;
            
            if (amount < 500) {
                riskLevel = 'High';
                monthlyReturn = 0.15; // 15% average
            } else if (amount < 5000) {
                riskLevel = 'Medium';
                monthlyReturn = 0.10; // 10% average
            } else {
                riskLevel = 'Low';
                monthlyReturn = 0.06; // 6% average
            }
            
            const monthlyProfit = amount * monthlyReturn;
            const totalReturn = monthlyProfit * period;
            const finalBalance = amount + totalReturn;
            
            document.getElementById('calc-risk').textContent = riskLevel;
            document.getElementById('calc-monthly').textContent = formatCurrency(monthlyProfit) + ' per month';
            document.getElementById('calc-total').textContent = formatCurrency(totalReturn);
            document.getElementById('calc-final').textContent = formatCurrency(finalBalance);
            document.getElementById('calc-results').style.display = 'block';
        }

        // ===== UTILITY FUNCTIONS =====
        function formatCurrency(amount) {
            return numeral(amount).format('$0,0.00');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Copied to clipboard!', 'success');
            });
        }

        // ===== AI CHAT BOT =====
        function toggleChat() {
            const chat = document.getElementById('aiChat');
            if (chat.style.display === 'none') {
                chat.style.display = 'flex';
            } else {
                chat.style.display = 'none';
            }
        }

        function initializeAIChatToggle() {
            // Add AI chat toggle button to dashboard
            const dashboardHeader = document.querySelector('.dashboard-header');
            if (dashboardHeader) {
                const aiButton = document.createElement('button');
                aiButton.className = 'btn btn-primary';
                aiButton.innerHTML = '<i class="fas fa-robot"></i> AI Assistant';
                aiButton.onclick = toggleChat;
                dashboardHeader.appendChild(aiButton);
            }
        }

        function handleChatInput(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatBody = document.getElementById('aiChatBody');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'ai-user-message';
            userMessage.textContent = message;
            chatBody.appendChild(userMessage);
            
            // Clear input
            input.value = '';
            
            // Scroll to bottom
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // Generate AI response
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                const aiMessage = document.createElement('div');
                aiMessage.className = 'ai-bot-message';
                aiMessage.textContent = aiResponse;
                chatBody.appendChild(aiMessage);
                
                // Scroll to bottom
                chatBody.scrollTop = chatBody.scrollHeight;
                
                // Log activity
                logUserActivity('ai_chat_interaction', `Asked: ${message}`, 'dashboard', {
                    userMessage: message,
                    aiResponse: aiResponse
                });
            }, 1000);
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Investment-related queries
            if (lowerMessage.includes('investment') || lowerMessage.includes('plan') || lowerMessage.includes('invest')) {
                return "Nexus offers three investment plans: Starter ($50-499, high risk), Growth ($500-4,999, medium risk), and Premium ($5,000-500,000, low risk). Our unique inverse risk model means larger investments have lower risk.";
            }
            
            // Risk-related queries
            if (lowerMessage.includes('risk') || lowerMessage.includes('safe') || lowerMessage.includes('security')) {
                return "Our inverse risk model means: lower investments carry higher risk, while higher investments enjoy lower risk. All funds are secured with industry-standard protection measures.";
            }
            
            // Returns-related queries
            if (lowerMessage.includes('return') || lowerMessage.includes('profit') || lowerMessage.includes('earn')) {
                return "Potential returns vary by plan: Starter (10-20% monthly), Growth (6-14% monthly), Premium (3-9% monthly). These are estimates and actual returns may vary based on market conditions.";
            }
            
            // Account-related queries
            if (lowerMessage.includes('account') || lowerMessage.includes('balance') || lowerMessage.includes('withdraw')) {
                return "You can check your account balance, transaction history, and submit withdrawal requests in your dashboard. Withdrawals typically process within 24-48 hours.";
            }
            
            // Referral-related queries
            if (lowerMessage.includes('referral') || lowerMessage.includes('friend') || lowerMessage.includes('invite')) {
                return "Our referral program gives you 5% of your friend's first deposit. Share your unique referral link from the dashboard to start earning.";
            }
            
            // Support-related queries
            if (lowerMessage.includes('help') || lowerMessage.includes('support') || lowerMessage.includes('contact')) {
                return "For assistance, you can submit a complaint through your dashboard or email our support team at nexussmartinvest@gmail.com. We typically respond within 24 hours.";
            }
            
            // Default response
            const responses = [
                "I'm here to help with questions about Nexus investment plans, your account, or general investment advice.",
                "Could you provide more details about your question? I can help with investment strategies, account management, or platform features.",
                "I specialize in Nexus investment products and platform features. How can I assist you today?",
                "For specific account issues, please check your dashboard or contact our support team at nexussmartinvest@gmail.com."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
    </script>
</body>
</html>