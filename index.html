<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Smart Investment Enterprise - Advanced Financial Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/numeral@2.0.6/numeral.min.js"></script>
    
    <!-- Enhanced Firebase v12 CDN -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, getDocs, orderBy, onSnapshot, serverTimestamp, increment, deleteDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBlCwlyX3ujq4R_FDWiGni_4FnQnX8C5hk",
            authDomain: "nexus-nexus.firebaseapp.com",
            projectId: "nexus-nexus",
            storageBucket: "nexus-nexus.firebasestorage.app",
            messagingSenderId: "769766068333",
            appId: "1:769766068333:web:d0676159280493d41e2f64",
            measurementId: "G-ND03G3PGHD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase available globally with enhanced functionality
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCreateUser = createUserWithEmailAndPassword;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseDoc = doc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseAddDoc = addDoc;
        window.firebaseCollection = collection;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseGetDocs = getDocs;
        window.firebaseOrderBy = orderBy;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseIncrement = increment;
        window.firebaseDeleteDoc = deleteDoc;
        window.onAuthStateChanged = onAuthStateChanged;
        window.firebaseUpdateProfile = updateProfile;
    </script>
    
    <style>
        /* ===== ENHANCED GLOBAL STYLES ===== */
        :root {
            --brand-gold: #d4af37;
            --brand-dark: #000000;
            --brand-light: #f8f9fa;
            --text-light: #ffffff;
            --text-dark: #111827;
            --bg-light: #f2f6fc;
            --bg-dark: #0d1117;
            --card-light: rgba(255, 255, 255, 0.92);
            --card-dark: rgba(30, 30, 40, 0.85);
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-dark: rgba(0, 0, 0, 0.4);
            --border-light: rgba(0, 0, 0, 0.1);
            --border-dark: rgba(255, 255, 255, 0.15);
            --success: #00c851;
            --warning: #ffbb33;
            --danger: #ff4444;
            --info: #33b5e5;
            --risk-high: #ff4444;
            --risk-medium: #ffbb33;
            --risk-low: #00c851;
            --stocks-color: #2196F3;
            --forex-color: #4CAF50;
            --crypto-color: #FF9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            transition: background-color 0.4s, color 0.4s;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ===== ENHANCED GLASSMORPHISM EFFECT ===== */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .glass {
            background: rgba(30, 30, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== ENHANCED BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--brand-gold), #e6c34e);
            color: var(--text-dark);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #b8942f, #d4af37);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-dark);
            border: 1px solid var(--border-light);
        }

        .dark-mode .btn-secondary {
            color: var(--text-light);
            border: 1px solid var(--border-dark);
        }

        .btn-secondary:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-outline {
            background: transparent;
            color: var(--brand-gold);
            border: 1px solid var(--brand-gold);
        }

        .btn-outline:hover {
            background: var(--brand-gold);
            color: var(--text-dark);
        }

        .btn-loading {
            position: relative;
            color: transparent;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== ENHANCED HEADER & NAVIGATION ===== */
        header {
            background: var(--brand-gold);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .logo i {
            font-size: 28px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s, transform 0.2s;
        }

        nav a:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        /* ===== ADJUSTED MENU ICON POSITIONING ===== */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-dark);
            transition: transform 0.3s;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
            background: rgba(0, 0, 0, 0.05);
        }

        .mobile-menu {
            display: none;
            font-size: 24px;
            cursor: pointer;
            background: transparent;
            border: none;
            color: var(--text-dark);
            padding: 5px;
            border-radius: 4px;
            width: 40px;
            height: 40px;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .mobile-menu:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        /* ===== PAGES ===== */
        .page {
            display: none;
            flex: 1;
            width: 100%;
        }

        .page.active {
            display: block;
        }

        /* ===== ENHANCED HOME PAGE ===== */
        .hero {
            min-height: calc(100vh - 140px);
            padding: 0 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), 
                              url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: white;
            position: relative;
        }

        .dark-mode .hero {
            background-image: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), 
                              url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
        }

        .hero h1 {
            font-size: 52px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--brand-gold), #f1c40f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 20px;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.7;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .hero-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .features {
            padding: 80px 0;
            background: var(--bg-light);
        }

        .dark-mode .features {
            background: var(--bg-dark);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .feature-card {
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            background: var(--card-light);
            box-shadow: 0 5px 15px var(--shadow-light);
        }

        .dark-mode .feature-card {
            background: var(--card-dark);
            box-shadow: 0 5px 15px var(--shadow-dark);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--brand-gold);
        }

        .feature-card h3 {
            margin-bottom: 15px;
            color: var(--brand-gold);
        }

        /* ===== ENHANCED ABOUT PAGE ===== */
        .about-page-content {
            min-height: calc(100vh - 140px);
            padding: 60px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .about-content {
            line-height: 1.8;
            font-size: 18px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
        }

        .about-content h3 {
            margin: 30px 0 15px;
            color: var(--brand-gold);
            border-bottom: 2px solid var(--brand-gold);
            padding-bottom: 8px;
        }

        .about-content p {
            margin-bottom: 20px;
            text-align: justify;
            word-spacing: normal; /* Fix for word spacing issues */
        }

        .market-expertise {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .market-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
        }

        .dark-mode .market-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .market-card:hover {
            transform: translateY(-5px);
        }

        .market-card.stocks {
            border-top: 4px solid var(--stocks-color);
        }

        .market-card.forex {
            border-top: 4px solid var(--forex-color);
        }

        .market-card.crypto {
            border-top: 4px solid var(--crypto-color);
        }

        .market-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .market-card.stocks .market-icon {
            color: var(--stocks-color);
        }

        .market-card.forex .market-icon {
            color: var(--forex-color);
        }

        .market-card.crypto .market-icon {
            color: var(--crypto-color);
        }

        /* ===== ENHANCED REVIEWS PAGE ===== */
        .reviews-page-content {
            min-height: calc(100vh - 140px);
            padding: 60px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }

        .review-card {
            padding: 25px;
            border-radius: 12px;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
        }

        .dark-mode .review-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .review-card:hover {
            transform: translateY(-5px);
        }

        .review-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .review-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            border: 2px solid var(--brand-gold);
        }

        .review-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .review-rating {
            color: var(--brand-gold);
        }

        .review-text {
            line-height: 1.6;
            font-style: italic;
        }

        /* ===== ENHANCED REVIEW FORM ===== */
        .review-form-container {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 12px;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        .dark-mode .review-form-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .review-form h3 {
            margin-bottom: 15px;
            color: var(--brand-gold);
        }

        .rating-input {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .rating-star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
        }

        .rating-star:hover {
            transform: scale(1.2);
        }

        .rating-star.active {
            color: var(--brand-gold);
        }

        .review-form textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .dark-mode .review-form textarea {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .review-form textarea:focus {
            border-color: var(--brand-gold);
            outline: none;
        }

        .review-form button {
            margin-top: 10px;
        }

        /* ===== ENHANCED CONTACT PAGE ===== */
        .contact-page-content {
            min-height: calc(100vh - 140px);
            padding: 60px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .contact-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .dark-mode .form-group input,
        .dark-mode .form-group textarea,
        .dark-mode .form-group select {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--brand-gold);
            outline: none;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .contact-info {
            text-align: center;
            margin-top: 30px;
        }

        .contact-email {
            color: var(--brand-gold);
            text-decoration: none;
            cursor: pointer;
            transition: color 0.3s;
            font-weight: 600;
        }

        .contact-email:hover {
            text-decoration: underline;
        }

        /* ===== ENHANCED FOOTER ===== */
        footer {
            background: var(--brand-dark);
            color: var(--text-light);
            padding: 30px 0 20px;
            text-align: center;
            width: 100%;
            margin-top: auto;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-links a {
            color: var(--text-light);
            text-decoration: none;
            transition: color 0.3s;
            padding: 5px 10px;
        }

        .footer-links a:hover {
            color: var(--brand-gold);
        }

        .copyright {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
        }

        /* ===== ENHANCED LOGIN/REGISTER PAGE ===== */
        .auth-container {
            min-height: calc(100vh - 140px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 0;
        }

        .auth-box {
            width: 100%;
            max-width: 500px;
            padding: 40px;
            border-radius: 16px;
            background: var(--card-light);
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .dark-mode .auth-box {
            background: var(--card-dark);
            box-shadow: 0 10px 30px var(--shadow-dark);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .auth-tabs {
            border-bottom: 1px solid var(--border-dark);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-tab.active {
            border-bottom: 3px solid var(--brand-gold);
            color: var(--brand-gold);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Password visibility toggle */
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 38px;
            cursor: pointer;
            color: var(--text-dark);
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .dark-mode .password-toggle {
            color: var(--text-light);
        }

        .password-toggle:hover {
            opacity: 1;
        }

        /* ===== ENHANCED DASHBOARD ===== */
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 140px);
        }

        .sidebar {
            width: 280px;
            background: var(--card-light);
            padding: 20px 0;
            box-shadow: 2px 0 10px var(--shadow-light);
            position: relative;
            transition: width 0.3s;
        }

        .dark-mode .sidebar {
            background: var(--card-dark);
            box-shadow: 2px 0 10px var(--shadow-dark);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 20px;
            position: relative;
        }

        .dark-mode .sidebar-header {
            border-bottom: 1px solid var(--border-dark);
        }

        .sidebar-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.3s;
            border-radius: 8px;
            margin: 0 10px;
        }

        .dark-mode .sidebar-menu a {
            color: var(--text-light);
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(212, 175, 55, 0.1);
            border-right: 3px solid var(--brand-gold);
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        /* ===== ENHANCED DASHBOARD STYLES ===== */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .dashboard-title {
            color: var(--brand-gold);
            font-size: 32px;
            margin-bottom: 10px;
        }

        .dashboard-subtitle {
            color: var(--text-dark);
            opacity: 0.8;
            font-size: 16px;
        }

        .dark-mode .dashboard-subtitle {
            color: var(--text-light);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .stat-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--brand-gold);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            color: var(--brand-gold);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-top: 30px;
        }

        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-card {
            padding: 25px;
            border-radius: 12px;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 20px;
        }

        .dark-mode .dashboard-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .dashboard-card h3 {
            margin-bottom: 20px;
            color: var(--brand-gold);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dashboard-card h3 i {
            font-size: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .info-row {
            border-bottom: 1px solid var(--border-dark);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
        }

        .info-value {
            color: var(--brand-gold);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .payment-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
        }

        .dark-mode .payment-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .payment-card:hover {
            transform: translateY(-5px);
        }

        .qr-code {
            width: 150px;
            height: 150px;
            margin: 15px auto;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .transaction-table th,
        .transaction-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .transaction-table th,
        .dark-mode .transaction-table td {
            border-bottom: 1px solid var(--border-dark);
        }

        .transaction-table th {
            font-weight: 600;
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .transaction-table th {
            background: rgba(255, 255, 255, 0.05);
        }

        .status-pending {
            color: var(--warning);
            font-weight: 600;
        }

        .status-approved {
            color: var(--success);
            font-weight: 600;
        }

        .status-declined {
            color: var(--danger);
            font-weight: 600;
        }

        .chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
            overflow: hidden;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        .dark-mode .chat-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .chat-header {
            padding: 15px 20px;
            background: var(--brand-gold);
            color: var(--text-dark);
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.4;
        }

        .message.user {
            align-self: flex-end;
            background: var(--brand-gold);
            color: var(--text-dark);
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            align-self: flex-start;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-bottom-left-radius: 5px;
        }

        .dark-mode .message.ai {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--border-light);
        }

        .dark-mode .chat-input {
            border-top: 1px solid var(--border-dark);
        }

        .chat-input input {
            flex: 1;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
        }

        .dark-mode .chat-input input {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .chat-input button {
            margin-left: 10px;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            background: var(--brand-gold);
            color: var(--text-dark);
            cursor: pointer;
            font-weight: 600;
        }

        .notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }

        .notification {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-light);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .notification {
            box-shadow: 0 4px 12px var(--shadow-dark);
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.info {
            background: var(--info);
            color: white;
        }

        .notification.warning {
            background: var(--warning);
            color: var(--text-dark);
        }

        .notification.error {
            background: var(--danger);
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== ENHANCED INVESTMENT PLANS ===== */
        .investment-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .investment-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            background: var(--card-light);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .investment-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .investment-card:hover {
            transform: translateY(-5px);
        }

        .investment-card h3 {
            color: var(--brand-gold);
            margin-bottom: 15px;
        }

        .investment-card p {
            margin: 10px 0;
            font-size: 16px;
        }

        .investment-card .btn {
            margin-top: 15px;
            width: 100%;
        }

        .risk-indicator {
            position: absolute;
            top: 0;
            right: 0;
            padding: 5px 10px;
            border-radius: 0 0 0 8px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .risk-high {
            background-color: var(--risk-high);
            color: white;
        }

        .risk-medium {
            background-color: var(--risk-medium);
            color: var(--text-dark);
        }

        .risk-low {
            background-color: var(--risk-low);
            color: white;
        }

        /* ===== ENHANCED AI CHAT BOT ===== */
        .ai-chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 360px;
            height: 500px;
            background: var(--card-light);
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            color: var(--text-dark);
            z-index: 999;
            transition: all 0.3s ease;
            transform: translateY(0);
            opacity: 1;
        }

        .dark-mode .ai-chat-container {
            background: var(--card-dark);
            color: var(--text-light);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .ai-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--brand-gold), #e6c34e);
            color: var(--text-dark);
            font-weight: 600;
            font-size: 16px;
        }

        .ai-chat-header button {
            background: none;
            border: none;
            color: var(--text-dark);
            font-size: 18px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .ai-chat-header button:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .ai-chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: var(--card-light);
        }

        .dark-mode .ai-chat-body {
            background: var(--card-dark);
        }

        .ai-chat-input-area {
            display: flex;
            border-top: 1px solid var(--border-light);
            padding: 15px;
            background: var(--card-light);
        }

        .dark-mode .ai-chat-input-area {
            border-top: 1px solid var(--border-dark);
            background: var(--card-dark);
        }

        .ai-chat-input-area input {
            flex: 1;
            border: 1px solid var(--border-light);
            padding: 12px 15px;
            font-size: 14px;
            outline: none;
            background: var(--card-light);
            color: var(--text-dark);
            border-radius: 20px;
        }

        .dark-mode .ai-chat-input-area input {
            background: var(--card-dark);
            color: var(--text-light);
            border: 1px solid var(--border-dark);
        }

        .ai-chat-input-area input:focus {
            border-color: var(--brand-gold);
        }

        .ai-chat-input-area button {
            background: var(--brand-gold);
            border: none;
            padding: 12px 18px;
            color: var(--text-dark);
            cursor: pointer;
            font-weight: 600;
            border-radius: 20px;
            margin-left: 10px;
            min-width: 70px;
            transition: all 0.3s;
        }

        .ai-chat-input-area button:hover {
            background: #b8942f;
            transform: translateY(-2px);
        }

        .ai-user-message, .ai-bot-message {
            margin: 6px 0;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .ai-user-message {
            background: var(--brand-gold);
            color: var(--text-dark);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .ai-bot-message {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            color: var(--text-dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .dark-mode .ai-bot-message {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
            color: var(--text-light);
        }

        /* AI Chat Button - FIXED POSITIONING */
        .ai-chat-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--brand-gold), #e6c34e);
            color: var(--text-dark);
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 998;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }

        /* AI Chat States */
        .ai-chat-container.hidden {
            transform: translateY(20px);
            opacity: 0;
            pointer-events: none;
        }

        .ai-chat-typing {
            display: inline-block;
        }

        .ai-chat-typing::after {
            content: '...';
            animation: typing 1.5s infinite;
        }

        @keyframes typing {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ===== ENHANCED MERGED INVESTMENT & DEPOSIT SECTION ===== */
        .investment-deposit-flow {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }

        .plan-selection {
            flex: 1;
        }

        .deposit-section {
            flex: 1;
            display: none;
        }

        .deposit-section.active {
            display: block;
        }

        .selected-plan-info {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--brand-gold);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .plan-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--brand-gold);
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .step-content {
            flex: 1;
        }

        /* ===== ENHANCED CRYPTO ADDRESS UPLOAD STYLES ===== */
        .crypto-address-upload {
            margin-bottom: 20px;
        }

        .crypto-address-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .crypto-address-area {
            border: 2px dashed var(--border-light);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--card-light);
        }

        .dark-mode .crypto-address-area {
            border-color: var(--border-dark);
            background: var(--card-dark);
        }

        .crypto-address-area:hover {
            border-color: var(--brand-gold);
        }

        .crypto-address-area.active {
            border-color: var(--brand-gold);
            background: rgba(212, 175, 55, 0.05);
        }

        .crypto-address-icon {
            font-size: 40px;
            color: var(--brand-gold);
            margin-bottom: 10px;
        }

        .crypto-address-text {
            margin-bottom: 10px;
        }

        .crypto-address-btn {
            display: inline-block;
            padding: 8px 16px;
            background: var(--brand-gold);
            color: var(--text-dark);
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }

        .crypto-address-input {
            display: none;
        }

        .crypto-address-preview-container {
            margin-top: 15px;
            display: none;
        }

        .crypto-address-preview-container.active {
            display: block;
        }

        .crypto-address-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .remove-crypto-address {
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* ===== ENHANCED MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            margin: 5% auto;
            max-width: 90%;
            max-height: 80%;
            background: var(--card-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .dark-mode .modal-content {
            background: var(--card-dark);
        }

        .modal-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        /* ===== ENHANCED PORTFOLIO ALLOCATION ===== */
        .portfolio-allocation {
            margin-top: 30px;
        }

        .allocation-chart {
            display: flex;
            height: 200px;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .allocation-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
        }

        .allocation-segment:hover {
            transform: scale(1.05);
        }

        .allocation-stocks {
            background-color: var(--stocks-color);
        }

        .allocation-forex {
            background-color: var(--forex-color);
        }

        .allocation-crypto {
            background-color: var(--crypto-color);
        }

        .allocation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .allocation-detail {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .allocation-detail.stocks {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid var(--stocks-color);
        }

        .allocation-detail.forex {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--forex-color);
        }

        .allocation-detail.crypto {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--crypto-color);
        }

        /* ===== ENHANCED RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .investment-deposit-flow {
                flex-direction: column;
            }
        }

        @media (max-width: 992px) {
            .hero h1 {
                font-size: 42px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .investment-deposit-flow {
                flex-direction: column;
            }

            .ai-chat-container {
                width: 320px;
                height: 450px;
            }
        }

        @media (max-width: 768px) {
            .mobile-menu {
                display: flex;
            }
            
            nav ul {
                display: none;
                position: absolute;
                top: 70px;
                left: 0;
                right: 0;
                background: var(--brand-gold);
                flex-direction: column;
                padding: 20px;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            }
            
            nav ul.show {
                display: flex;
            }
            
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar-menu li {
                flex-shrink: 0;
            }
            
            .sidebar-menu a {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
            }

            .investment-plans {
                grid-template-columns: 1fr;
            }

            .ai-chat-container {
                width: calc(100vw - 40px);
                height: 400px;
                right: 20px;
                bottom: 20px;
                left: 20px;
            }

            .ai-chat-button {
                right: 20px;
                bottom: 20px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .market-expertise {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .hero h1 {
                font-size: 32px;
            }
            
            .hero p {
                font-size: 16px;
            }
            
            .hero-btns {
                flex-direction: column;
                align-items: center;
            }
            
            .section-title {
                font-size: 28px;
            }
            
            .auth-box {
                padding: 20px;
                margin: 10px;
            }

            .ai-chat-container {
                width: calc(100vw - 30px);
                height: 380px;
                right: 15px;
                bottom: 15px;
                left: 15px;
            }

            .ai-chat-button {
                right: 15px;
                bottom: 15px;
            }
            
            .footer-content {
                padding: 0 15px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== ADDITIONAL ENHANCEMENTS ===== */
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--brand-gold);
            font-size: 36px;
        }

        .small-text {
            font-size: 12px;
            opacity: 0.7;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .dark-mode .form-control {
            border: 1px solid var(--border-dark);
            background: var(--card-dark);
            color: var(--text-light);
        }

        .form-control:focus {
            border-color: var(--brand-gold);
            outline: none;
        }

        /* ===== ENHANCED USER IDENTIFIER STYLES ===== */
        .user-identifier {
            display: inline-block;
            padding: 5px 10px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
            margin-top: 5px;
            color: var(--brand-gold);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .identifier-container {
            margin-top: 10px;
            font-size: 14px;
        }

        .identifier-label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        /* ===== ENHANCED EMPTY STATE STYLES ===== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dark);
        }

        .dark-mode .empty-state {
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: var(--brand-gold);
            opacity: 0.7;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            font-size: 24px;
        }

        .empty-state p {
            margin-bottom: 20px;
            opacity: 0.8;
        }

        /* ===== ENHANCED PROGRESS BARS ===== */
        .progress-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .dark-mode .progress-bar {
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--brand-gold);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* ===== ENHANCED LOADING STATES ===== */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            transform: translateX(-100%);
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
    </style>
</head>
<body>
    <!-- Notification Center -->
    <div class="notification-center" id="notificationCenter"></div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <span class="close-modal">&times;</span>
        <div class="modal-content">
            <img id="modalImage" class="modal-image">
        </div>
    </div>

    <!-- AI Chat Bot -->
    <div id="aiChat" class="ai-chat-container hidden">
        <div class="ai-chat-header">
            <span>🤖 Nexus AI Assistant</span>
            <button id="aiChatClose">−</button>
        </div>
        <div class="ai-chat-body" id="aiChatBody">
            <div class="ai-bot-message">Hello 👋, I'm your Nexus AI Assistant. Ask me about your account, investment strategies, or market insights!</div>
        </div>
        <div class="ai-chat-input-area">
            <input type="text" id="aiChatInput" placeholder="Type your question here...">
            <button id="aiChatSend">Send</button>
        </div>
    </div>

    <!-- AI Chat Button -->
    <button class="ai-chat-button" id="aiChatButton">🤖</button>

    <!-- Header (Common for all pages) -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>Nexus Smart Investment</span>
                </div>
                <nav>
                    <ul id="nav-menu">
                        <li><a href="#" class="nav-link active" data-page="home-page">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="about-page">About</a></li>
                        <li><a href="#" class="nav-link" data-page="reviews-page">Reviews</a></li>
                        <li><a href="#" class="nav-link" data-page="contact-page">Contact</a></li>
                        <li><a href="#" class="nav-link" id="login-link">Login</a></li>
                        <li><a href="#" class="btn btn-primary" id="register-link">Get Started</a></li>
                    </ul>
                    <div class="header-controls">
                        <button class="mobile-menu" id="mobile-menu">
                            <i class="fas fa-bars"></i>
                        </button>
                        <button class="theme-toggle" id="themeToggle">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <!-- Home Page -->
    <div id="home-page" class="page active">
        <section class="hero">
            <div class="container">
                <h1>Strategic Investment Solutions for Discerning Investors</h1>
                <p>A Finland-based financial platform offering sophisticated portfolio management across equities, forex, and digital assets with institutional-grade security and transparent reporting.</p>
                <p><strong>Proprietary Risk Model:</strong> Strategic allocation balancing risk exposure with investment size for optimized portfolio performance.</p>
                <div class="hero-btns">
                    <a href="#" class="btn btn-primary" id="hero-register-link">Create Account</a>
                    <a href="#" class="btn btn-secondary" id="learn-more-link">Learn More</a>
                </div>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <h2 class="section-title">Our Investment Approach</h2>
                <div class="features-grid">
                    <div class="feature-card glass">
                        <div class="feature-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3>Risk-Adjusted Allocation</h3>
                        <p>Our proprietary inverse risk model strategically allocates capital based on investment size, optimizing risk exposure while maximizing potential returns across market conditions.</p>
                    </div>
                    <div class="feature-card glass">
                        <div class="feature-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <h3>Multi-Asset Diversification</h3>
                        <p>Strategic exposure to global equities, major currency pairs, and select digital assets creates a diversified portfolio designed to withstand market volatility while capturing growth opportunities.</p>
                    </div>
                    <div class="feature-card glass">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Institutional Security</h3>
                        <p>Bank-grade encryption, multi-signature wallets, and segregated client accounts ensure the highest standards of capital protection and operational integrity.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- About Page -->
    <div id="about-page" class="page">
        <div class="container about-page-content">
            <h2 class="section-title">About Nexus Smart Investment</h2>
            <div class="about-content glass">
                <h3>Our Strategic Investment Philosophy</h3>
                <p>Nexus Smart Investment Enterprise represents a paradigm shift in sophisticated wealth management. Our platform integrates advanced financial technology with institutional-grade portfolio strategies to deliver exceptional risk-adjusted returns across global markets.</p>

                <h3>Proprietary Risk Management Framework</h3>
                <p>Unlike conventional investment models that apply uniform risk parameters, Nexus employs a sophisticated risk-calibrated approach. Our proprietary allocation algorithm dynamically adjusts portfolio exposure based on investment size, ensuring optimal risk-return profiles tailored to each investor's capital commitment.</p>

                <h3>Multi-Asset Portfolio Strategy</h3>
                <p>Nexus maintains strategic positions across three core asset classes:</p>
                
                <div class="market-expertise">
                    <div class="market-card stocks">
                        <div class="market-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h4>Global Equities</h4>
                        <p>Strategic positions in blue-chip stocks, growth sectors, and emerging markets with fundamental analysis-driven selection criteria.</p>
                    </div>
                    <div class="market-card forex">
                        <div class="market-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <h4>Forex Markets</h4>
                        <p>Expert trading across major, minor, and exotic currency pairs utilizing technical analysis and macroeconomic forecasting.</p>
                    </div>
                    <div class="market-card crypto">
                        <div class="market-icon">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                        <h4>Digital Assets</h4>
                        <p>Select exposure to established cryptocurrencies and blockchain projects with strong fundamentals and growth potential.</p>
                    </div>
                </div>

                <h3>Strategic Allocation Methodology</h3>
                <p>Our investment structure employs sophisticated capital allocation techniques. Smaller investments ($50-$499) target higher-growth opportunities with calculated risk exposure. Medium allocations ($500-$4,999) balance growth potential with capital preservation through diversified positions. Substantial investments ($5,000-$500,000) benefit from our most conservative, institutionally-vetted strategies with maximum capital protection.</p>

                <h3>Transparency and Investor Communication</h3>
                <p>Regardless of investment size, all portfolio activities are documented with comprehensive reporting. Our transparent communication framework ensures investors maintain full visibility into strategy implementation, performance metrics, and risk exposure at all times.</p>

                <h3>Global Market Access with Regulatory Compliance</h3>
                <p>While headquartered in Finland, our investment operations span global financial markets. We maintain rigorous compliance with international financial regulations while providing sophisticated investors access to diversified opportunities across equities, forex, and digital assets.</p>

                <h3>Long-Term Partnership Model</h3>
                <p>Nexus operates on a partnership philosophy rather than transactional relationships. Our success metrics align with long-term client outcomes, reflected in our commitment to comprehensive reporting, tax documentation support, and strategy evolution informed by investor feedback.</p>
            </div>
        </div>
    </div>

    <!-- Reviews Page -->
    <div id="reviews-page" class="page">
        <div class="container reviews-page-content">
            <h2 class="section-title">Client Testimonials</h2>
            
            <!-- Review Form -->
            <div class="review-form-container glass">
                <div class="review-form">
                    <h3>Share Your Investment Experience</h3>
                    <div class="form-group">
                        <label for="reviewer-name">Your Name</label>
                        <input type="text" id="reviewer-name" class="form-control" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Your Rating</label>
                        <div class="rating-input">
                            <span class="rating-star" data-rating="1">★</span>
                            <span class="rating-star" data-rating="2">★</span>
                            <span class="rating-star" data-rating="3">★</span>
                            <span class="rating-star" data-rating="4">★</span>
                            <span class="rating-star" data-rating="5">★</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="review-text">Your Review</label>
                        <textarea id="review-text" class="form-control" placeholder="Share your investment experience with Nexus Smart Investment..."></textarea>
                    </div>
                    <button class="btn btn-primary" id="submit-review">Submit Review</button>
                </div>
            </div>
            
            <div class="reviews-grid" id="reviewsGrid">
                <!-- Reviews will be dynamically generated from Firestore -->
            </div>
        </div>
    </div>

    <!-- Contact Page -->
    <div id="contact-page" class="page">
        <div class="container contact-page-content">
            <h2 class="section-title">Client Support</h2>
            <div class="contact-form glass">
                <div class="form-group">
                    <label for="contact-name">Your Name</label>
                    <input type="text" id="contact-name" class="form-control" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="contact-email">Your Email</label>
                    <input type="email" id="contact-email" class="form-control" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="contact-message">Message</label>
                    <textarea id="contact-message" class="form-control" placeholder="How can we assist with your investment needs?"></textarea>
                </div>
                <button type="button" class="btn btn-primary" style="width: 100%;" id="contact-submit">Send Message</button>
            </div>
            <div class="contact-info">
                <p><i class="fas fa-envelope"></i> Email: <span class="contact-email" id="contact-email-text">nexussmartinvest@gmail.com</span></p>
                <p><i class="fas fa-map-marker-alt"></i> Location: Finland</p>
            </div>
        </div>
    </div>

    <!-- Login/Register Page -->
    <div id="auth-page" class="page">
        <section class="auth-container">
            <div class="auth-box glass">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">Login</div>
                    <div class="auth-tab" data-tab="register">Register</div>
                </div>

                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                        <span class="password-toggle" id="login-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="login-submit">Login</button>
                </form>

                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" required>
                        <span class="password-toggle" id="reg-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-password">Confirm Password</label>
                        <input type="password" id="reg-confirm-password" class="form-control" required>
                        <span class="password-toggle" id="reg-confirm-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="register-submit">Register</button>
                </form>
            </div>
        </section>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <div class="dashboard-container">
            <div class="sidebar glass">
                <div class="sidebar-header">
                    <div class="sidebar-header-top">
                        <div class="logo">
                            <i class="fas fa-chart-line"></i>
                            <span>Nexus</span>
                        </div>
                    </div>
                    <p>Welcome, <span id="dashboard-username">Investor</span></p>
                    <div class="identifier-container">
                        <span class="identifier-label">Your Email:</span>
                        <div class="user-identifier" id="dashboard-email">Not Available</div>
                    </div>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" class="dashboard-link active" data-section="overview"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" class="dashboard-link" data-section="transactions"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
                    <li><a href="#" class="dashboard-link" data-section="investment-plans"><i class="fas fa-coins"></i> Investment Plans</a></li>
                    <li><a href="#" class="dashboard-link" data-section="portfolio"><i class="fas fa-chart-pie"></i> Portfolio Allocation</a></li>
                    <li><a href="#" class="dashboard-link" data-section="withdraw"><i class="fas fa-arrow-up"></i> Withdraw</a></li>
                    <li><a href="#" class="dashboard-link" data-section="complaint"><i class="fas fa-exclamation-circle"></i> Submit Complaint</a></li>
                    <li><a href="#" class="dashboard-link" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li>
                    <li><a href="#" id="dashboard-logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </div>

            <div class="main-content">
                <!-- Dashboard Overview -->
                <section id="overview" class="dashboard-section active">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Portfolio Dashboard</h1>
                            <p class="dashboard-subtitle">Comprehensive overview of your investment performance and account status</p>
                        </div>
                        <div class="identifier-container">
                            <span class="identifier-label">Your Email:</span>
                            <div class="user-identifier" id="overview-email">Not Available</div>
                        </div>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <h3>Account Balance</h3>
                            <div class="stat-value" id="account-balance">$0.00</div>
                            <p class="stat-label">Total available capital</p>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Active Investments</h3>
                            <div class="stat-value" id="active-investments">$0.00</div>
                            <p class="stat-label">Deployed across strategies</p>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h3>Total Returns</h3>
                            <div class="stat-value" id="total-profit">$0.00</div>
                            <p class="stat-label">Cumulative performance</p>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <h3>Referral Earnings</h3>
                            <div class="stat-value" id="referral-earnings">$0.00</div>
                            <p class="stat-label">From referral program</p>
                        </div>
                    </div>

                    <!-- Portfolio Allocation Preview -->
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-pie"></i> Portfolio Allocation</h3>
                        <p>Your current investment distribution across asset classes:</p>
                        <div class="allocation-chart">
                            <div class="allocation-segment allocation-stocks" style="width: 45%;">Equities 45%</div>
                            <div class="allocation-segment allocation-forex" style="width: 30%;">Forex 30%</div>
                            <div class="allocation-segment allocation-crypto" style="width: 25%;">Crypto 25%</div>
                        </div>
                        <div class="allocation-details">
                            <div class="allocation-detail stocks">
                                <h4>Equity Positions</h4>
                                <p>Blue-chip stocks and growth sectors</p>
                            </div>
                            <div class="allocation-detail forex">
                                <h4>Forex Exposure</h4>
                                <p>Major and minor currency pairs</p>
                            </div>
                            <div class="allocation-detail crypto">
                                <h4>Digital Assets</h4>
                                <p>Established cryptocurrencies</p>
                            </div>
                        </div>
                    </div>

                    <!-- Referral Program Section -->
                    <div class="dashboard-card">
                        <h3><i class="fas fa-user-plus"></i> Referral Program</h3>
                        <div class="info-row">
                            <span class="info-label">Your Referral Code:</span>
                            <span class="info-value" id="user-referral-code">Loading...</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Your Referral Link:</span>
                            <div style="flex: 1;">
                                <input type="text" id="user-referral-link" readonly 
                                       style="width: 100%; padding: 8px; border: 1px solid var(--border-light); border-radius: 4px; background: var(--card-light);">
                                <button class="btn btn-primary" id="copy-referral-link" style="margin-top: 8px;">
                                    <i class="fas fa-copy"></i> Copy Link
                                </button>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Referrals:</span>
                            <span class="info-value" id="total-referrals">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Referral Earnings:</span>
                            <span class="info-value" id="referral-earnings-display">$0.00</span>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 8px;">
                            <h4><i class="fas fa-gift"></i> Program Benefits</h4>
                            <p>• Share your unique referral link with colleagues</p>
                            <p>• Referred investors receive 5% bonus on initial deposit</p>
                            <p>• You earn 5% of their first strategic allocation</p>
                            <p>• Unlimited referral potential with tiered benefits</p>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3><i class="fas fa-user"></i> Account Information</h3>
                            <div class="info-row">
                                <span class="info-label">Username:</span>
                                <span class="info-value" id="overview-username">Not Available</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value" id="overview-email-display">Not Available</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Member Since:</span>
                                <span class="info-value" id="overview-join-date">Not Available</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Last Login:</span>
                                <span class="info-value" id="overview-last-login">Not Available</span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-lightbulb"></i> Market Intelligence</h3>
                        <p id="weekly-insight">Loading market analysis and strategic insights...</p>
                    </div>
                </section>

                <!-- Transactions -->
                <section id="transactions" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Transaction History</h1>
                            <p class="dashboard-subtitle">Comprehensive record of all account activities and capital movements</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="transaction-filter">Filter by Transaction Type:</label>
                            <select id="transaction-filter" class="form-control">
                                <option value="all">All Transactions</option>
                                <option value="deposit">Capital Deposits</option>
                                <option value="withdrawal">Withdrawals</option>
                                <option value="investment">Strategic Allocations</option>
                                <option value="referral">Referral Earnings</option>
                            </select>
                        </div>
                        <div id="transaction-history">
                            <!-- Transaction history will be populated from Firestore -->
                        </div>
                    </div>
                </section>

                <!-- Investment Plans (Merged with Deposit) -->
                <section id="investment-plans" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Strategic Investment Plans</h1>
                            <p class="dashboard-subtitle">Select from our risk-calibrated investment strategies aligned with your financial objectives</p>
                        </div>
                    </div>
                    
                    <div class="investment-deposit-flow">
                        <div class="plan-selection">
                            <div class="plan-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h3>Select Investment Strategy</h3>
                                    <p>Choose a strategic allocation matching your risk tolerance and return expectations</p>
                                </div>
                            </div>
                            
                            <div class="investment-plans">
                                <div class="investment-card glass">
                                    <div class="risk-indicator risk-high">Growth Focus</div>
                                    <h3>Emerging Opportunities</h3>
                                    <p><strong>Allocation Range:</strong> $50 - $499</p>
                                    <p><strong>Target Returns:</strong> 10-20% monthly</p>
                                    <p><strong>Investment Horizon:</strong> 3-6 months</p>
                                    <p><strong>Risk Profile:</strong> Higher volatility with growth potential</p>
                                    <button class="btn btn-primary" data-plan="Emerging Opportunities" data-amount="50" data-risk="Growth Focus">Select Strategy</button>
                                </div>

                                <div class="investment-card glass">
                                    <div class="risk-indicator risk-medium">Balanced Approach</div>
                                    <h3>Strategic Growth</h3>
                                    <p><strong>Allocation Range:</strong> $500 - $4,999</p>
                                    <p><strong>Target Returns:</strong> 6-14% monthly</p>
                                    <p><strong>Investment Horizon:</strong> 6-12 months</p>
                                    <p><strong>Risk Profile:</strong> Balanced risk-return optimization</p>
                                    <button class="btn btn-primary" data-plan="Strategic Growth" data-amount="500" data-risk="Balanced Approach">Select Strategy</button>
                                </div>

                                <div class="investment-card glass">
                                    <div class="risk-indicator risk-low">Capital Preservation</div>
                                    <h3>Institutional Portfolio</h3>
                                    <p><strong>Allocation Range:</strong> $5,000 - $500,000</p>
                                    <p><strong>Target Returns:</strong> 3-9% monthly</p>
                                    <p><strong>Investment Horizon:</strong> 12-24 months</p>
                                    <p><strong>Risk Profile:</strong> Capital preservation with steady growth</p>
                                    <button class="btn btn-primary" data-plan="Institutional Portfolio" data-amount="5000" data-risk="Capital Preservation">Select Strategy</button>
                                </div>
                            </div>
                        </div>

                        <div id="deposit-section" class="deposit-section">
                            <div class="plan-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h3>Fund Your Strategy</h3>
                                    <p>Complete your strategic allocation by depositing capital</p>
                                </div>
                            </div>
                            
                            <div id="selected-plan-info" class="selected-plan-info" style="display: none;">
                                <h4>Selected Strategy: <span id="selected-plan-name"></span></h4>
                                <p>Minimum Allocation: <strong id="selected-plan-amount"></strong></p>
                                <p>Risk Profile: <strong id="selected-plan-risk"></strong></p>
                                <button class="btn btn-secondary" id="change-plan-btn">Change Strategy</button>
                            </div>
                            
                            <div class="payment-methods">
                                <div class="payment-card glass">
                                    <h3><i class="fab fa-bitcoin"></i> Bitcoin (BTC)</h3>
                                    <p class="wallet-address">bc1qc97mk5j9qgypjprgdps6t24xrqz7xr3at9txhj</p>
                                    <div class="qr-code">
                                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #fff; color: #000;">
                                            BTC QR Code
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" data-wallet="bc1qc97mk5j9qgypjprgdps6t24xrqz7xr3at9txhj">Copy Address</button>
                                </div>

                                <div class="payment-card glass">
                                    <h3><i class="fab fa-ethereum"></i> Ethereum (ERC20)</h3>
                                    <p class="wallet-address">0xCb456E64733Cfe809422f95e7178e566834483F2</p>
                                    <div class="qr-code">
                                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #fff; color: #000;">
                                            ETH QR Code
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" data-wallet="0xCb456E64733Cfe809422f95e7178e566834483F2">Copy Address</button>
                                </div>

                                <div class="payment-card glass">
                                    <h3><i class="fab fa-btc"></i> Binance Coin (BEP20)</h3>
                                    <p class="wallet-address">0xCb456E64733Cfe809422f95e7178e566834483F2</p>
                                    <div class="qr-code">
                                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #fff; color: #000;">
                                            BNB QR Code
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" data-wallet="0xCb456E64733Cfe809422f95e7178e566834483F2">Copy Address</button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <h3><i class="fas fa-check-circle"></i> Confirm Capital Allocation</h3>
                                <p>After transferring funds, provide transaction details for accurate allocation to your selected strategy.</p>
                                <div class="form-group">
                                    <label for="deposit-method">Payment Method</label>
                                    <select id="deposit-method" class="form-control">
                                        <option value="BTC">Bitcoin (BTC)</option>
                                        <option value="ETH">Ethereum (ETH)</option>
                                        <option value="BNB">Binance Coin (BNB)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="deposit-amount">Allocation Amount (USD)</label>
                                    <input type="number" id="deposit-amount" class="form-control" placeholder="Enter allocation amount">
                                </div>
                                
                                <!-- Crypto Address Upload Section -->
                                <div class="crypto-address-upload">
                                    <label class="crypto-address-label">Crypto Address Used for Transfer</label>
                                    <div class="crypto-address-area" id="crypto-address-area">
                                        <div class="crypto-address-icon">
                                            <i class="fas fa-wallet"></i>
                                        </div>
                                        <div class="crypto-address-text">
                                            <p>Upload a screenshot of the crypto address used for capital transfer</p>
                                            <p class="small-text">Supported formats: JPG, PNG, GIF (Max: 5MB)</p>
                                        </div>
                                        <div class="crypto-address-btn">Choose File</div>
                                        <input type="file" id="crypto-address-proof" class="crypto-address-input" accept="image/*">
                                    </div>
                                    <div class="crypto-address-preview-container" id="crypto-address-preview-container">
                                        <img id="crypto-address-preview" class="crypto-address-preview">
                                        <button type="button" class="remove-crypto-address" id="remove-crypto-address">Remove Image</button>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" id="deposit-submit">Confirm Allocation</button>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-calculator"></i> Strategic Allocation Calculator</h3>
                        <p>Project potential returns based on our proprietary risk-calibrated model.</p>
                        <div class="form-group">
                            <label for="calc-amount">Allocation Amount ($)</label>
                            <input type="number" id="calc-amount" class="form-control" value="1000" min="50" step="50">
                        </div>
                        <div class="form-group">
                            <label for="calc-period">Investment Horizon (months)</label>
                            <input type="number" id="calc-period" class="form-control" value="12" min="1" max="60">
                        </div>
                        <button class="btn btn-secondary" id="calculate-investment">Calculate Projections</button>
                        <div id="calc-results" style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 8px; display: none;">
                            <h4>Strategic Return Projections</h4>
                            <p>Risk Profile: <span id="calc-risk"></span></p>
                            <p>Estimated Monthly Return: <span id="calc-monthly"></span></p>
                            <p>Total Projected Return: <span id="calc-total"></span></p>
                            <p>Projected Portfolio Value: <span id="calc-final"></span></p>
                        </div>
                    </div>
                </section>

                <!-- Portfolio Allocation -->
                <section id="portfolio" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Portfolio Allocation</h1>
                            <p class="dashboard-subtitle">Detailed breakdown of your strategic positions across asset classes</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-pie"></i> Current Allocation</h3>
                        <p>Your capital is strategically deployed across multiple asset classes for optimal diversification.</p>
                        
                        <div class="allocation-chart">
                            <div class="allocation-segment allocation-stocks" style="width: 45%;">Equities 45%</div>
                            <div class="allocation-segment allocation-forex" style="width: 30%;">Forex 30%</div>
                            <div class="allocation-segment allocation-crypto" style="width: 25%;">Crypto 25%</div>
                        </div>
                        
                        <div class="allocation-details">
                            <div class="allocation-detail stocks">
                                <h4>Equity Positions (45%)</h4>
                                <p><strong>Blue-Chip Stocks:</strong> 25% - Established companies with strong fundamentals</p>
                                <p><strong>Growth Sectors:</strong> 15% - Technology, healthcare, and renewable energy</p>
                                <p><strong>Emerging Markets:</strong> 5% - High-growth potential international equities</p>
                            </div>
                            <div class="allocation-detail forex">
                                <h4>Forex Exposure (30%)</h4>
                                <p><strong>Major Pairs:</strong> 20% - EUR/USD, GBP/USD, USD/JPY</p>
                                <p><strong>Minor Pairs:</strong> 7% - Cross-currency opportunities</p>
                                <p><strong>Exotic Pairs:</strong> 3% - Emerging market currencies</p>
                            </div>
                            <div class="allocation-detail crypto">
                                <h4>Digital Assets (25%)</h4>
                                <p><strong>Established Cryptocurrencies:</strong> 15% - Bitcoin, Ethereum</p>
                                <p><strong>Altcoin Portfolio:</strong> 7% - Selected alternative cryptocurrencies</p>
                                <p><strong>Blockchain Projects:</strong> 3% - Strategic positions in promising projects</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3><i class="fas fa-sync-alt"></i> Rebalancing Strategy</h3>
                        <p>Our proprietary algorithm continuously monitors market conditions and automatically rebalances your portfolio to maintain optimal risk exposure and capitalize on emerging opportunities.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%;"></div>
                        </div>
                        <p style="text-align: center; margin-top: 10px;">Next scheduled rebalancing: 7 days</p>
                    </div>
                </section>

                <!-- Withdraw -->
                <section id="withdraw" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Capital Withdrawal</h1>
                            <p class="dashboard-subtitle">Submit withdrawal requests for available account balance</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="form-group">
                            <label for="withdraw-method">Withdrawal Method</label>
                            <select id="withdraw-method" class="form-control">
                                <option value="BTC">Bitcoin (BTC)</option>
                                <option value="ETH">Ethereum (ETH)</option>
                                <option value="BNB">Binance Coin (BNB)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="withdraw-amount">Withdrawal Amount (USD)</label>
                            <input type="number" id="withdraw-amount" class="form-control" placeholder="Enter withdrawal amount">
                        </div>
                        <div class="form-group">
                            <label for="withdraw-address">Destination Wallet Address</label>
                            <input type="text" id="withdraw-address" class="form-control" placeholder="Paste your wallet address">
                        </div>
                        <button class="btn btn-primary" id="withdraw-submit">Submit Withdrawal Request</button>
                    </div>
                </section>

                <!-- Submit Complaint -->
                <section id="complaint" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Client Support Request</h1>
                            <p class="dashboard-subtitle">Our dedicated support team addresses all inquiries within 24 hours</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="complaint-form">
                            <div class="form-group">
                                <label for="complaint-type">Inquiry Category</label>
                                <select id="complaint-type" class="form-control">
                                    <option value="technical">Technical Issue</option>
                                    <option value="transaction">Transaction Inquiry</option>
                                    <option value="account">Account Management</option>
                                    <option value="investment">Strategy Consultation</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="complaint-subject">Subject</label>
                                <input type="text" id="complaint-subject" class="form-control" placeholder="Brief description of your inquiry">
                            </div>
                            <div class="form-group">
                                <label for="complaint-message">Detailed Description</label>
                                <textarea id="complaint-message" class="form-control" placeholder="Please provide comprehensive details regarding your inquiry..."></textarea>
                            </div>
                            <button class="btn btn-primary" id="complaint-submit">Submit Inquiry</button>
                        </div>
                    </div>
                </section>

                <!-- Settings -->
                <section id="settings" class="dashboard-section">
                    <div class="dashboard-header">
                        <div>
                            <h1 class="dashboard-title">Account Management</h1>
                            <p class="dashboard-subtitle">Manage your account preferences and personal information</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="form-group">
                            <label for="settings-name">Full Name</label>
                            <input type="text" id="settings-name" class="form-control" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="settings-username">Username</label>
                            <input type="text" id="settings-username" class="form-control" placeholder="Enter your username">
                        </div>
                        <div class="form-group">
                            <label for="settings-email">Email</label>
                            <input type="email" id="settings-email" class="form-control" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="settings-phone">Phone Number</label>
                            <input type="tel" id="settings-phone" class="form-control" placeholder="Enter your phone number">
                        </div>
                        <div class="form-group">
                            <label for="settings-postal">Postal Code</label>
                            <input type="text" id="settings-postal" class="form-control" placeholder="Enter your postal code">
                        </div>
                        <div class="form-group">
                            <label for="settings-country">Country</label>
                            <input type="text" id="settings-country" class="form-control" placeholder="Enter your country">
                        </div>
                        <div class="form-group">
                            <label for="settings-password">New Password</label>
                            <input type="password" id="settings-password" class="form-control" placeholder="Enter new password">
                            <span class="password-toggle" id="settings-password-toggle">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <div class="form-group">
                            <label for="settings-confirm-password">Confirm New Password</label>
                            <input type="password" id="settings-confirm-password" class="form-control" placeholder="Confirm new password">
                            <span class="password-toggle" id="settings-confirm-password-toggle">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <button class="btn btn-primary" id="settings-submit">Update Profile</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer (Common for all pages) -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>Nexus Smart Investment</span>
                </div>
                <div class="footer-links">
                    <a href="#" data-page="home-page">Home</a>
                    <a href="#" data-page="about-page">About</a>
                    <a href="#" data-page="reviews-page">Reviews</a>
                    <a href="#" data-page="contact-page">Contact</a>
                    <a href="#" id="footer-login-link">Login</a>
                </div>
                <p class="copyright">© <span id="current-year">2023</span> Nexus Smart Investment Enterprise. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // ===== ENHANCED GLOBAL VARIABLES =====
        let currentUser = null;
        let userRating = 0;
        let selectedPlan = null;
        let cryptoAddressImage = null;
        let userUnsubscribe = null;
        let transactionsUnsubscribe = null;
        let reviewsUnsubscribe = null;
        let portfolioData = {
            stocks: 45,
            forex: 30,
            crypto: 25
        };

        // Google Apps Script URL for automatic emails
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxUanZifBhRcHfUNKeR_szRBr0375HL2DIGSyR1YuApe0HuXpB9gR6ki1qxmuHtHnhAMA/exec';

        // ===== ENHANCED PAGE MANAGEMENT =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Set current year in footer - changed to 2023 as requested
            document.getElementById('current-year').textContent = '2023';
            
            // Initialize reviews from Firestore
            setupReviewsListener();
            
            // Check for referral codes in URL
            handleReferralRegistration();
            
            // Check if user is logged in via Firebase Auth
            window.onAuthStateChanged(window.firebaseAuth, (user) => {
                if (user) {
                    // User is signed in
                    fetchUserData(user.email);
                } else {
                    // User is signed out
                    currentUser = null;
                    
                    // Unsubscribe from real-time listeners
                    if (userUnsubscribe) userUnsubscribe();
                    if (transactionsUnsubscribe) transactionsUnsubscribe();
                    if (reviewsUnsubscribe) reviewsUnsubscribe();
                    
                    // Show login page
                    showPage('home-page');
                }
            });
            
            // Initialize rating stars
            initializeRatingStars();
            
            // Initialize crypto address upload functionality
            initializeCryptoAddressUpload();
            
            // Initialize modal functionality
            initializeModal();
            
            // Initialize AI chat toggle
            initializeAIChatToggle();
            
            // Initialize password visibility toggles
            initializePasswordToggles();
            
            // Add email event listeners
            initializeEmailListeners();
            
            // Add event listeners for all interactive elements
            addEventListeners();
        });

        // ===== ENHANCED EVENT LISTENER MANAGEMENT =====
        function addEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', handleNavClick);
            });
            
            // Footer navigation
            document.querySelectorAll('.footer-links a').forEach(link => {
                link.addEventListener('click', handleNavClick);
            });
            
            // Auth links
            document.getElementById('login-link').addEventListener('click', handleAuthLink);
            document.getElementById('register-link').addEventListener('click', handleAuthLink);
            document.getElementById('hero-register-link').addEventListener('click', handleAuthLink);
            document.getElementById('learn-more-link').addEventListener('click', handleLearnMore);
            document.getElementById('footer-login-link').addEventListener('click', handleAuthLink);
            
            // Auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', handleAuthTab);
            });
            
            // Auth forms
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            
            // Dashboard navigation
            document.querySelectorAll('.dashboard-link').forEach(link => {
                link.addEventListener('click', handleDashboardNav);
            });
            
            // Dashboard logout
            document.getElementById('dashboard-logout').addEventListener('click', handleLogout);
            
            // Contact form
            document.getElementById('contact-submit').addEventListener('click', handleContactSubmit);
            
            // Mobile menu
            document.getElementById('mobile-menu').addEventListener('click', handleMobileMenu);
            
            // Transaction filter
            document.getElementById('transaction-filter').addEventListener('change', handleTransactionFilter);
            
            // Investment plan selection
            document.querySelectorAll('.investment-card .btn').forEach(button => {
                button.addEventListener('click', handlePlanSelection);
            });
            
            // Change plan button
            document.getElementById('change-plan-btn').addEventListener('click', handleChangePlan);
            
            // Copy wallet address buttons
            document.querySelectorAll('[data-wallet]').forEach(button => {
                button.addEventListener('click', handleCopyWallet);
            });
            
            // Deposit submission
            document.getElementById('deposit-submit').addEventListener('click', handleDepositSubmit);
            
            // Investment calculator
            document.getElementById('calculate-investment').addEventListener('click', handleCalculateInvestment);
            
            // Withdrawal submission
            document.getElementById('withdraw-submit').addEventListener('click', handleWithdrawalSubmit);
            
            // Complaint submission
            document.getElementById('complaint-submit').addEventListener('click', handleComplaintSubmit);
            
            // Settings update
            document.getElementById('settings-submit').addEventListener('click', handleSettingsUpdate);
            
            // Review submission
            document.getElementById('submit-review').addEventListener('click', handleReviewSubmit);
            
            // Referral link copy
            document.getElementById('copy-referral-link').addEventListener('click', handleCopyReferralLink);
            
            // AI Chat functionality - FIXED EVENT LISTENERS
            document.getElementById('aiChatClose').addEventListener('click', toggleChat);
            document.getElementById('aiChatButton').addEventListener('click', toggleChat);
            document.getElementById('aiChatSend').addEventListener('click', sendAIMessage);
            document.getElementById('aiChatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendAIMessage();
                }
            });
        }

        // ===== EVENT HANDLER FUNCTIONS =====
        function handleNavClick(e) {
            e.preventDefault();
            const page = this.getAttribute('data-page');
            if (page) {
                showPage(page);
            }
            
            // Close mobile menu if open
            document.getElementById('nav-menu').classList.remove('show');
        }

        function handleAuthLink(e) {
            e.preventDefault();
            showPage('auth-page');
            if (this.id.includes('register')) {
                switchAuthTab('register');
            }
        }

        function handleLearnMore(e) {
            e.preventDefault();
            showPage('about-page');
        }

        function handleAuthTab(e) {
            const tabName = this.getAttribute('data-tab');
            switchAuthTab(tabName);
        }

        function handleLogin(e) {
            e.preventDefault();
            loginUser();
        }

        function handleRegister(e) {
            e.preventDefault();
            registerUser();
        }

        function handleDashboardNav(e) {
            e.preventDefault();
            const section = this.getAttribute('data-section');
            switchDashboardSection(section);
        }

        function handleLogout(e) {
            e.preventDefault();
            logout();
        }

        function handleContactSubmit() {
            submitContactForm();
        }

        function handleMobileMenu() {
            document.getElementById('nav-menu').classList.toggle('show');
        }

        function handleTransactionFilter() {
            updateTransactionHistory();
        }

        function handlePlanSelection() {
            const planName = this.getAttribute('data-plan');
            const minAmount = parseInt(this.getAttribute('data-amount'));
            const riskProfile = this.getAttribute('data-risk');
            selectPlan(planName, minAmount, riskProfile);
        }

        function handleChangePlan() {
            changePlan();
        }

        function handleCopyWallet() {
            const walletAddress = this.getAttribute('data-wallet');
            copyToClipboard(walletAddress);
        }

        function handleDepositSubmit() {
            confirmDeposit();
        }

        function handleCalculateInvestment() {
            calculateInvestment();
        }

        function handleWithdrawalSubmit() {
            submitWithdrawal();
        }

        function handleComplaintSubmit() {
            submitComplaint();
        }

        function handleSettingsUpdate() {
            updateProfile();
        }

        function handleReviewSubmit() {
            submitReview();
        }

        function handleCopyReferralLink() {
            copyReferralLink();
        }

        // ===== GOOGLE APPS SCRIPT INTEGRATION =====
        async function triggerEmailNotification(type, userData, additionalData = {}) {
            try {
                const emailData = {
                    type: type,
                    userEmail: userData.email,
                    userName: userData.fullName || userData.username || 'User',
                    timestamp: new Date().toISOString(),
                    ...additionalData
                };

                console.log('Sending email notification:', emailData);

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Important for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailData)
                });

                // Since we're using no-cors mode, we can't read the response
                // But we can assume it was sent successfully if no error is thrown
                console.log('Email notification triggered for:', type);
                
                return true;
            } catch (error) {
                console.error('Error triggering email notification:', error);
                // Don't show error to user as this is a background process
                return false;
            }
        }

        // Enhanced user data fetching
        async function fetchUserData(email) {
            try {
                // Use email as document ID for easy tracking
                const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", email));
                if (userDoc.exists()) {
                    currentUser = userDoc.data();
                    showPage('dashboard-page');
                    setupRealTimeListeners();
                    loadUserSettings();
                    
                    // Log successful login
                    await logUserActivity('user_login', `User ${email} logged in successfully`, 'dashboard');
                } else {
                    console.log("No user document found with email:", email);
                    showNotification('User data not found. Please contact support.', 'error');
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
                showNotification('Error loading user data. Please try again.', 'error');
            }
        }

        // Enhanced real-time listeners
        function setupRealTimeListeners() {
            if (!currentUser) return;
            
            // Set up real-time listener for user data using email as document ID
            userUnsubscribe = window.firebaseOnSnapshot(
                window.firebaseDoc(window.firebaseDb, "users", currentUser.email),
                (doc) => {
                    if (doc.exists()) {
                        currentUser = doc.data();
                        updateDashboard();
                    }
                },
                (error) => {
                    console.error('Error in user data listener:', error);
                    // Only show error if we're on the dashboard
                    if (document.getElementById('dashboard-page').classList.contains('active')) {
                        showNotification('Error updating user data', 'error');
                    }
                }
            );
            
            // Set up real-time listener for transactions using email for tracking
            const transactionsQuery = window.firebaseQuery(
                window.firebaseCollection(window.firebaseDb, "transactions"),
                window.firebaseWhere("userEmail", "==", currentUser.email)
            );
            
            transactionsUnsubscribe = window.firebaseOnSnapshot(
                transactionsQuery,
                (snapshot) => {
                    const transactions = [];
                    snapshot.forEach(doc => {
                        transactions.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Sort transactions by date (newest first)
                    transactions.sort((a, b) => {
                        const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
                        const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
                        return dateB - dateA;
                    });
                    
                    updateTransactionHistory(transactions);
                },
                (error) => {
                    console.error('Error in transactions listener:', error);
                    // Only show error if we're on the transactions page
                    if (document.getElementById('transactions').classList.contains('active')) {
                        showNotification('Error updating transaction history', 'error');
                    }
                }
            );
        }

        // ===== ENHANCED FIREBASE AUTHENTICATION WITH EMAIL TRIGGERS =====
        async function registerUser() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            
            if (!fullName || !email || !username || !password) {
                showNotification('Please complete all required fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Password confirmation does not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('register-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create user with Firebase Auth
                const userCredential = await window.firebaseCreateUser(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                // Update profile with display name
                await window.firebaseUpdateProfile(user, {
                    displayName: fullName
                });
                
                // Check for referral code
                const referralCode = sessionStorage.getItem('pendingReferral');
                let referrerId = null;
                
                if (referralCode) {
                    // Find the user with this referral code
                    const usersRef = window.firebaseCollection(window.firebaseDb, "users");
                    const q = window.firebaseQuery(usersRef, window.firebaseWhere("referralCode", "==", referralCode));
                    const querySnapshot = await window.firebaseGetDocs(q);
                    
                    if (!querySnapshot.empty) {
                        referrerId = querySnapshot.docs[0].id; // This will be the email
                    }
                }
                
                // Create user data object
                const userData = {
                    id: user.uid,
                    fullName: fullName,
                    email: email,
                    username: username,
                    balance: 0,
                    activeInvestments: 0,
                    totalProfit: 0,
                    referralEarnings: 0,
                    joined: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    referralCode: generateReferralCode(),
                    referralLink: getReferralLink(generateReferralCode()),
                    referrals: [],
                    referredBy: referrerId,
                    phone: '',
                    postal: '',
                    country: '',
                    portfolio: portfolioData,
                    createdAt: window.firebaseServerTimestamp()
                };
                
                // Save user data to Firestore using email as document ID for easy tracking
                await window.firebaseSetDoc(window.firebaseDoc(window.firebaseDb, "users", email), userData);
                
                // If referred by someone, update their referrals
                if (referrerId) {
                    await window.firebaseUpdateDoc(
                        window.firebaseDoc(window.firebaseDb, "users", referrerId),
                        {
                            referrals: window.firebaseIncrement(1),
                            referralEarnings: window.firebaseIncrement(25) // $25 referral bonus
                        }
                    );
                    
                    // Create referral record
                    await window.firebaseAddDoc(
                        window.firebaseCollection(window.firebaseDb, "referrals"),
                        {
                            referrerId: referrerId,
                            referredUserId: email,
                            referredEmail: email,
                            status: 'completed',
                            bonusAmount: 25,
                            createdAt: window.firebaseServerTimestamp()
                        }
                    );
                    
                    sessionStorage.removeItem('pendingReferral');
                }
                
                // Set current user and update UI
                currentUser = userData;
                
                // Trigger welcome email
                triggerEmailNotification('registration', userData, {
                    username: username,
                    referralCode: userData.referralCode
                });
                
                showNotification('Account successfully created! Welcome to Nexus.', 'success');
                showPage('dashboard-page');
                setupRealTimeListeners();
                
                // Log registration
                await logUserActivity('user_registered', `New user registered: ${email}`, 'dashboard');
                
            } catch (error) {
                console.error('Registration error:', error);
                
                // Enhanced error handling
                let errorMessage = 'Registration failed. Please try again.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'This email is already registered. Please use a different email or login.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak. Please use a stronger password.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email address. Please check your email format.';
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Please enter your email and password', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('login-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Sign in with Firebase Auth
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                // Get user data from Firestore using email as document ID
                const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", email));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userData.lastLogin = new Date().toISOString();
                    
                    // Update last login in Firestore
                    await window.firebaseSetDoc(window.firebaseDoc(window.firebaseDb, "users", email), userData, { merge: true });
                    
                    // Set current user and update UI
                    currentUser = userData;
                    
                    showNotification(`Welcome back, ${userData.fullName.split(' ')[0]}!`, 'success');
                    showPage('dashboard-page');
                    setupRealTimeListeners();
                    
                    // Log successful login
                    await logUserActivity('user_login', `User ${email} logged in successfully`, 'dashboard');
                } else {
                    showNotification('User account not found. Please contact support.', 'error');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                
                // Enhanced error handling
                let errorMessage = 'Login failed. Please check your credentials and try again.';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'No account found with this email. Please register first.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Incorrect password. Please try again.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Too many failed attempts. Please try again later.';
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function logout() {
            try {
                // Log logout activity
                if (currentUser) {
                    await logUserActivity('user_logout', `User ${currentUser.email} logged out`, 'global');
                }
                
                await window.firebaseSignOut(window.firebaseAuth);
                currentUser = null;
                
                // Unsubscribe from real-time listeners
                if (userUnsubscribe) userUnsubscribe();
                if (transactionsUnsubscribe) transactionsUnsubscribe();
                if (reviewsUnsubscribe) reviewsUnsubscribe();
                
                showNotification('You have been successfully logged out', 'info');
                showPage('home-page');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Logout failed. Please try again.', 'error');
            }
        }

        // ===== ENHANCED ACTIVITY LOGGING =====
        async function logUserActivity(eventType, details = '', page = '', additionalData = {}) {
            if (!currentUser) return;
            
            try {
                const activityData = {
                    userId: currentUser.id,
                    userEmail: currentUser.email,
                    username: currentUser.username,
                    eventType: eventType,
                    details: details,
                    page: page,
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString(),
                    createdAt: window.firebaseServerTimestamp(),
                    ...additionalData
                };

                // Save to Firestore activities collection
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "activities"),
                    activityData
                );
                
                return { status: 'success', message: 'Activity logged' };
            } catch (error) {
                console.error('Failed to log activity:', error);
                return { status: 'error', message: 'Failed to log activity' };
            }
        }

        // ===== ENHANCED EMAIL EVENT LISTENERS =====
        function initializeEmailListeners() {
            // Contact page email
            const contactEmail = document.getElementById('contact-email-text');
            if (contactEmail) {
                contactEmail.addEventListener('click', function() {
                    window.location.href = 'mailto:nexussmartinvest@gmail.com?subject=Nexus%20Investment%20Inquiry';
                    logUserActivity('email_click', 'Clicked contact email', 'contact');
                });
            }
            
            // Dashboard email copy
            const dashboardEmail = document.getElementById('dashboard-email');
            if (dashboardEmail) {
                dashboardEmail.addEventListener('click', function() {
                    copyToClipboard(currentUser.email);
                    showNotification('Email address copied to clipboard', 'success');
                    logUserActivity('email_copy', 'Copied email address', 'dashboard');
                });
            }
        }

        // ===== ENHANCED DASHBOARD FUNCTIONALITY =====
        function updateDashboard() {
            if (!currentUser) return;
            
            // Update user info
            document.getElementById('dashboard-username').textContent = currentUser.fullName || 'Investor';
            document.getElementById('dashboard-email').textContent = currentUser.email || 'Not Available';
            document.getElementById('overview-email').textContent = currentUser.email || 'Not Available';
            document.getElementById('overview-email-display').textContent = currentUser.email || 'Not Available';
            document.getElementById('overview-username').textContent = currentUser.username || 'Not Available';
            
            // Format dates
            const joinDate = new Date(currentUser.joined || new Date()).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('overview-join-date').textContent = joinDate;
            
            const lastLogin = new Date(currentUser.lastLogin || new Date()).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('overview-last-login').textContent = lastLogin;
            
            // Update account values
            document.getElementById('account-balance').textContent = formatCurrency(currentUser.balance || 0);
            document.getElementById('active-investments').textContent = formatCurrency(currentUser.activeInvestments || 0);
            document.getElementById('total-profit').textContent = formatCurrency(currentUser.totalProfit || 0);
            document.getElementById('referral-earnings').textContent = formatCurrency(currentUser.referralEarnings || 0);
            document.getElementById('referral-earnings-display').textContent = formatCurrency(currentUser.referralEarnings || 0);
            
            // Update referral information
            document.getElementById('user-referral-code').textContent = currentUser.referralCode || 'Not Available';
            document.getElementById('user-referral-link').value = currentUser.referralLink || 'Not Available';
            document.getElementById('total-referrals').textContent = currentUser.referrals || 0;
            
            // Update portfolio allocation if available
            if (currentUser.portfolio) {
                portfolioData = currentUser.portfolio;
                updatePortfolioAllocation();
            }
            
            // Update transaction history
            updateTransactionHistory();
        }

        function updateTransactionHistory(transactions = []) {
            const transactionHistory = document.getElementById('transaction-history');
            const filter = document.getElementById('transaction-filter').value;
            
            if (!transactionHistory) return;
            
            // Check if we're on the transactions page
            const transactionsSection = document.getElementById('transactions');
            if (!transactionsSection || !transactionsSection.classList.contains('active')) {
                return; // Don't update if we're not on the transactions page
            }
            
            if (!transactions || transactions.length === 0) {
                transactionHistory.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3>No Transaction History</h3>
                        <p>Your account activity will appear here once you begin making strategic allocations or capital movements.</p>
                        <a href="#" class="btn btn-primary" data-section="investment-plans">Make Initial Allocation</a>
                    </div>
                `;
                return;
            }
            
            let filteredTransactions = transactions;
            if (filter !== 'all') {
                filteredTransactions = transactions.filter(t => t.type === filter);
            }
            
            if (filteredTransactions.length === 0) {
                transactionHistory.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-filter"></i>
                        </div>
                        <h3>No Matching Transactions</h3>
                        <p>No transactions found for the selected filter. Try changing the filter criteria.</p>
                    </div>
                `;
                return;
            }
            
            let transactionsHTML = `
                <table class="transaction-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredTransactions.forEach(transaction => {
                const date = new Date(transaction.createdAt).toLocaleDateString();
                const amount = formatCurrency(transaction.amount);
                const type = transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1);
                const method = transaction.method || 'N/A';
                const status = transaction.status || 'pending';
                
                let statusClass = 'status-pending';
                if (status === 'approved') {
                    statusClass = 'status-approved';
                } else if (status === 'declined') {
                    statusClass = 'status-declined';
                }
                
                transactionsHTML += `
                    <tr>
                        <td>${date}</td>
                        <td>${type}</td>
                        <td>${amount}</td>
                        <td>${method}</td>
                        <td><span class="${statusClass}">${status}</span></td>
                    </tr>
                `;
            });
            
            transactionsHTML += `
                    </tbody>
                </table>
            `;
            
            transactionHistory.innerHTML = transactionsHTML;
        }

        function updatePortfolioAllocation() {
            const allocationChart = document.querySelector('.allocation-chart');
            if (allocationChart && portfolioData) {
                allocationChart.innerHTML = `
                    <div class="allocation-segment allocation-stocks" style="width: ${portfolioData.stocks}%;">
                        Equities ${portfolioData.stocks}%
                    </div>
                    <div class="allocation-segment allocation-forex" style="width: ${portfolioData.forex}%;">
                        Forex ${portfolioData.forex}%
                    </div>
                    <div class="allocation-segment allocation-crypto" style="width: ${portfolioData.crypto}%;">
                        Crypto ${portfolioData.crypto}%
                    </div>
                `;
            }
        }

        // ===== ENHANCED INVESTMENT PLANS =====
        function selectPlan(planName, minAmount, riskProfile) {
            selectedPlan = {
                name: planName,
                minAmount: minAmount,
                riskProfile: riskProfile
            };
            
            document.getElementById('selected-plan-name').textContent = planName;
            document.getElementById('selected-plan-amount').textContent = formatCurrency(minAmount);
            document.getElementById('selected-plan-risk').textContent = riskProfile;
            document.getElementById('selected-plan-info').style.display = 'block';
            document.getElementById('deposit-section').classList.add('active');
            
            // Scroll to deposit section
            document.getElementById('deposit-section').scrollIntoView({ behavior: 'smooth' });
            
            // Log plan selection
            logUserActivity('plan_selected', `Selected ${planName} plan`, 'investment-plans');
        }

        function changePlan() {
            selectedPlan = null;
            document.getElementById('selected-plan-info').style.display = 'none';
            document.getElementById('deposit-section').classList.remove('active');
            
            // Scroll to plan selection
            document.querySelector('.plan-selection').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== ENHANCED CRYPTO ADDRESS UPLOAD =====
        function initializeCryptoAddressUpload() {
            const addressArea = document.getElementById('crypto-address-area');
            const addressInput = document.getElementById('crypto-address-proof');
            const addressPreview = document.getElementById('crypto-address-preview');
            const previewContainer = document.getElementById('crypto-address-preview-container');
            const removeButton = document.getElementById('remove-crypto-address');
            
            if (!addressArea || !addressInput) return;
            
            addressArea.addEventListener('click', function() {
                addressInput.click();
            });
            
            addressInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    // Check file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('File size must be less than 5MB', 'error');
                        return;
                    }
                    
                    // Check file type
                    if (!file.type.match('image.*')) {
                        showNotification('Please select an image file', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        cryptoAddressImage = e.target.result;
                        addressPreview.src = cryptoAddressImage;
                        previewContainer.classList.add('active');
                        addressArea.classList.add('active');
                    };
                    
                    reader.readAsDataURL(file);
                    
                    // Log image upload
                    logUserActivity('crypto_address_uploaded', 'Uploaded crypto address image', 'investment-plans');
                }
            });
            
            removeButton.addEventListener('click', function() {
                addressInput.value = '';
                cryptoAddressImage = null;
                previewContainer.classList.remove('active');
                addressArea.classList.remove('active');
                
                // Log image removal
                logUserActivity('crypto_address_removed', 'Removed crypto address image', 'investment-plans');
            });
        }

        // ===== ENHANCED DEPOSIT WITH EMAIL TRIGGER =====
        async function confirmDeposit() {
            if (!selectedPlan) {
                showNotification('Please select an investment strategy first', 'error');
                return;
            }
            
            const method = document.getElementById('deposit-method').value;
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            
            if (!amount || amount < selectedPlan.minAmount) {
                showNotification(`Minimum allocation for this strategy is ${formatCurrency(selectedPlan.minAmount)}`, 'error');
                return;
            }
            
            if (!cryptoAddressImage) {
                showNotification('Please upload a screenshot of the crypto address used for transfer', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('deposit-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create deposit record
                const depositData = {
                    userEmail: currentUser.email,
                    type: 'deposit',
                    method: method,
                    amount: amount,
                    status: 'pending',
                    plan: selectedPlan.name,
                    cryptoAddressProof: cryptoAddressImage,
                    createdAt: new Date().toISOString(),
                    processedAt: null
                };
                
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    depositData
                );
                
                // Trigger deposit confirmation email
                triggerEmailNotification('deposit', currentUser, {
                    amount: amount,
                    method: method,
                    plan: selectedPlan.name,
                    transactionId: depositData.id || 'pending'
                });
                
                showNotification(`Allocation request submitted for ${formatCurrency(amount)}. Our team will process it within 24 hours.`, 'success');
                
                // Reset form
                document.getElementById('deposit-amount').value = '';
                document.getElementById('crypto-address-proof').value = '';
                document.getElementById('crypto-address-preview-container').classList.remove('active');
                document.getElementById('crypto-address-area').classList.remove('active');
                cryptoAddressImage = null;
                
                // Log deposit request
                await logUserActivity('deposit_requested', `Requested ${formatCurrency(amount)} deposit for ${selectedPlan.name}`, 'investment-plans', {
                    amount: amount,
                    method: method,
                    plan: selectedPlan.name
                });
                
            } catch (error) {
                console.error('Deposit submission error:', error);
                showNotification('Failed to submit allocation request. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== ENHANCED WITHDRAWAL WITH EMAIL TRIGGER =====
        async function submitWithdrawal() {
            const method = document.getElementById('withdraw-method').value;
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const address = document.getElementById('withdraw-address').value;
            
            if (!amount || amount <= 0) {
                showNotification('Please enter a valid withdrawal amount', 'error');
                return;
            }
            
            if (!address) {
                showNotification('Please enter your wallet address', 'error');
                return;
            }
            
            if (amount > (currentUser.balance || 0)) {
                showNotification('Insufficient balance for this withdrawal', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('withdraw-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create withdrawal record
                const withdrawalData = {
                    userEmail: currentUser.email,
                    type: 'withdrawal',
                    method: method,
                    amount: amount,
                    address: address,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    processedAt: null
                };
                
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "transactions"),
                    withdrawalData
                );
                
                // Trigger withdrawal confirmation email
                triggerEmailNotification('withdrawal', currentUser, {
                    amount: amount,
                    method: method,
                    address: address,
                    transactionId: withdrawalData.id || 'pending'
                });
                
                showNotification(`Withdrawal request submitted for ${formatCurrency(amount)}. Processing typically takes 24-48 hours.`, 'success');
                
                // Reset form
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('withdraw-address').value = '';
                
                // Log withdrawal request
                await logUserActivity('withdrawal_requested', `Requested ${formatCurrency(amount)} withdrawal to ${address}`, 'withdraw', {
                    amount: amount,
                    method: method,
                    address: address
                });
                
            } catch (error) {
                console.error('Withdrawal submission error:', error);
                showNotification('Failed to submit withdrawal request. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== ENHANCED COMPLAINT SUBMISSION WITH EMAIL TRIGGER =====
        async function submitComplaint() {
            const type = document.getElementById('complaint-type').value;
            const subject = document.getElementById('complaint-subject').value;
            const message = document.getElementById('complaint-message').value;
            
            if (!subject || !message) {
                showNotification('Please complete all required fields', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('complaint-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create complaint record
                const complaintData = {
                    userEmail: currentUser.email,
                    type: type,
                    subject: subject,
                    message: message,
                    status: 'open',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "complaints"),
                    complaintData
                );
                
                // Trigger complaint notification email
                triggerEmailNotification('complaint', currentUser, {
                    complaintType: type,
                    subject: subject,
                    message: message,
                    complaintId: complaintData.id || 'pending'
                });
                
                showNotification('Support inquiry submitted successfully. Our team will respond within 24 hours.', 'success');
                
                // Reset form
                document.getElementById('complaint-subject').value = '';
                document.getElementById('complaint-message').value = '';
                
                // Log complaint submission
                await logUserActivity('complaint_submitted', `Submitted ${type} complaint: ${subject}`, 'complaint', {
                    type: type,
                    subject: subject
                });
                
            } catch (error) {
                console.error('Complaint submission error:', error);
                showNotification('Failed to submit inquiry. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== ENHANCED CONTACT FORM WITH EMAIL TRIGGER =====
        async function submitContactForm() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;
            
            if (!name || !email || !message) {
                showNotification('Please complete all required fields', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('contact-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create contact record
                const contactData = {
                    name: name,
                    email: email,
                    message: message,
                    createdAt: new Date().toISOString(),
                    status: 'new'
                };
                
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "contacts"),
                    contactData
                );
                
                // Trigger contact notification email
                triggerEmailNotification('contact', { email, fullName: name }, {
                    message: message,
                    contactId: contactData.id || 'pending'
                });
                
                showNotification('Message sent successfully. We will respond within 24 hours.', 'success');
                
                // Reset form
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-email').value = '';
                document.getElementById('contact-message').value = '';
                
                // Log contact submission
                await logUserActivity('contact_submitted', `Submitted contact form from ${email}`, 'contact', {
                    name: name,
                    email: email
                });
                
            } catch (error) {
                console.error('Contact submission error:', error);
                showNotification('Failed to send message. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== ENHANCED PROFILE UPDATE =====
        async function updateProfile() {
            const name = document.getElementById('settings-name').value;
            const username = document.getElementById('settings-username').value;
            const email = document.getElementById('settings-email').value;
            const phone = document.getElementById('settings-phone').value;
            const postal = document.getElementById('settings-postal').value;
            const country = document.getElementById('settings-country').value;
            const password = document.getElementById('settings-password').value;
            const confirmPassword = document.getElementById('settings-confirm-password').value;
            
            if (!name || !username || !email) {
                showNotification('Please complete all required fields', 'error');
                return;
            }
            
            if (password && password !== confirmPassword) {
                showNotification('Password confirmation does not match', 'error');
                return;
            }
            
            if (password && password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('settings-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Update user data
                const userData = {
                    fullName: name,
                    username: username,
                    email: email,
                    phone: phone,
                    postal: postal,
                    country: country,
                    updatedAt: new Date().toISOString()
                };
                
                // Update in Firestore using email as document ID
                await window.firebaseSetDoc(
                    window.firebaseDoc(window.firebaseDb, "users", currentUser.email),
                    userData,
                    { merge: true }
                );
                
                // Update current user object
                currentUser = { ...currentUser, ...userData };
                
                // Update Firebase Auth profile if email changed
                if (email !== currentUser.email) {
                    // Note: Changing email in Firebase Auth requires reauthentication
                    // For now, we'll just update the display name
                    await window.firebaseUpdateProfile(window.firebaseAuth.currentUser, {
                        displayName: name
                    });
                }
                
                // Update password if provided
                if (password) {
                    // Note: Changing password requires reauthentication in Firebase
                    // For security, we'll just log this for now
                    console.log('Password change requested (would require reauthentication in production)');
                }
                
                showNotification('Profile updated successfully', 'success');
                updateDashboard();
                
                // Log profile update
                await logUserActivity('profile_updated', 'Updated user profile information', 'settings');
                
            } catch (error) {
                console.error('Profile update error:', error);
                showNotification('Failed to update profile. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== ENHANCED REVIEW SYSTEM =====
        function initializeRatingStars() {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    userRating = rating;
                    
                    // Update star display
                    stars.forEach((s, index) => {
                        if (index < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    // Log rating interaction
                    logUserActivity('rating_selected', `Selected ${rating} star rating`, 'reviews');
                });
            });
        }

        async function submitReview() {
            const name = document.getElementById('reviewer-name').value;
            const text = document.getElementById('review-text').value;
            
            if (!name || !text) {
                showNotification('Please complete all required fields', 'error');
                return;
            }
            
            if (userRating === 0) {
                showNotification('Please select a rating', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submit-review');
            const originalText = submitBtn.textContent;
            
            submitBtn.innerHTML = '<div class="btn-loading"></div>';
            submitBtn.disabled = true;
            
            try {
                // Create review record
                const reviewData = {
                    name: name,
                    rating: userRating,
                    text: text,
                    approved: false, // Reviews need approval
                    createdAt: new Date().toISOString(),
                    userEmail: currentUser ? currentUser.email : null
                };
                
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, "reviews"),
                    reviewData
                );
                
                showNotification('Review submitted for approval. Thank you for your feedback!', 'success');
                
                // Reset form
                document.getElementById('reviewer-name').value = '';
                document.getElementById('review-text').value = '';
                userRating = 0;
                
                // Reset stars
                document.querySelectorAll('.rating-star').forEach(star => {
                    star.classList.remove('active');
                });
                
                // Log review submission
                await logUserActivity('review_submitted', 'Submitted user review', 'reviews', {
                    rating: userRating,
                    name: name
                });
                
            } catch (error) {
                console.error('Review submission error:', error);
                showNotification('Failed to submit review. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function setupReviewsListener() {
            // Set up real-time listener for approved reviews
            const reviewsQuery = window.firebaseQuery(
                window.firebaseCollection(window.firebaseDb, "reviews"),
                window.firebaseWhere("approved", "==", true)
            );
            
            reviewsUnsubscribe = window.firebaseOnSnapshot(
                reviewsQuery,
                (snapshot) => {
                    const reviews = [];
                    snapshot.forEach(doc => {
                        reviews.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Sort reviews by date (newest first)
                    reviews.sort((a, b) => {
                        const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
                        const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
                        return dateB - dateA;
                    });
                    
                    updateReviewsDisplay(reviews);
                },
                (error) => {
                    console.error('Error in reviews listener:', error);
                }
            );
        }

        function updateReviewsDisplay(reviews) {
            const reviewsGrid = document.getElementById('reviewsGrid');
            
            if (!reviews || reviews.length === 0) {
                reviewsGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3>No Reviews Yet</h3>
                        <p>Be the first to share your investment experience with Nexus.</p>
                    </div>
                `;
                return;
            }
            
            let reviewsHTML = '';
            
            reviews.forEach(review => {
                const date = new Date(review.createdAt).toLocaleDateString();
                const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                
                reviewsHTML += `
                    <div class="review-card glass">
                        <div class="review-header">
                            <div class="review-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div>
                                <div class="review-name">${review.name}</div>
                                <div class="review-rating">${stars}</div>
                            </div>
                        </div>
                        <div class="review-text">${review.text}</div>
                        <div class="review-date">${date}</div>
                    </div>
                `;
            });
            
            reviewsGrid.innerHTML = reviewsHTML;
        }

        // ===== ENHANCED CALCULATOR FUNCTIONALITY =====
        function calculateInvestment() {
            const amount = parseFloat(document.getElementById('calc-amount').value);
            const period = parseInt(document.getElementById('calc-period').value);
            
            if (!amount || amount < 50) {
                showNotification('Minimum investment amount is $50', 'error');
                return;
            }
            
            if (!period || period < 1) {
                showNotification('Investment period must be at least 1 month', 'error');
                return;
            }
            
            // Calculate returns based on investment size (risk-calibrated model)
            let monthlyReturn;
            let riskProfile;
            
            if (amount < 500) {
                monthlyReturn = 0.15; // 15% monthly
                riskProfile = 'Growth Focus';
            } else if (amount < 5000) {
                monthlyReturn = 0.10; // 10% monthly
                riskProfile = 'Balanced Approach';
            } else {
                monthlyReturn = 0.06; // 6% monthly
                riskProfile = 'Capital Preservation';
            }
            
            const monthlyReturnAmount = amount * monthlyReturn;
            const totalReturn = monthlyReturnAmount * period;
            const finalAmount = amount + totalReturn;
            
            document.getElementById('calc-risk').textContent = riskProfile;
            document.getElementById('calc-monthly').textContent = formatCurrency(monthlyReturnAmount);
            document.getElementById('calc-total').textContent = formatCurrency(totalReturn);
            document.getElementById('calc-final').textContent = formatCurrency(finalAmount);
            document.getElementById('calc-results').style.display = 'block';
            
            // Log calculator usage
            logUserActivity('calculator_used', `Calculated returns for ${formatCurrency(amount)} over ${period} months`, 'investment-plans', {
                amount: amount,
                period: period,
                riskProfile: riskProfile,
                projectedReturn: totalReturn
            });
        }

        // ===== ENHANCED REFERRAL SYSTEM =====
        function handleReferralRegistration() {
            const urlParams = new URLSearchParams(window.location.search);
            const referralCode = urlParams.get('ref');
            
            if (referralCode) {
                sessionStorage.setItem('pendingReferral', referralCode);
                showNotification('Referral code detected. You will receive bonus benefits upon registration.', 'info');
                
                // Log referral detection
                logUserActivity('referral_detected', `Detected referral code: ${referralCode}`, 'global');
            }
        }

        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function getReferralLink(code) {
            return `${window.location.origin}${window.location.pathname}?ref=${code}`;
        }

        function copyReferralLink() {
            const referralLink = document.getElementById('user-referral-link').value;
            copyToClipboard(referralLink);
            showNotification('Referral link copied to clipboard', 'success');
            
            // Log referral link copy
            logUserActivity('referral_link_copied', 'Copied referral link to clipboard', 'dashboard');
        }

        // ===== ENHANCED AI CHAT BOT =====
        function initializeAIChatToggle() {
            const chatButton = document.getElementById('aiChatButton');
            const chatContainer = document.getElementById('aiChat');
            const chatClose = document.getElementById('aiChatClose');
            
            if (chatButton && chatContainer && chatClose) {
                chatButton.addEventListener('click', toggleChat);
                chatClose.addEventListener('click', toggleChat);
            }
        }

        function toggleChat() {
            const chatContainer = document.getElementById('aiChat');
            chatContainer.classList.toggle('hidden');
            
            // Log chat toggle
            logUserActivity('ai_chat_toggled', `AI chat ${chatContainer.classList.contains('hidden') ? 'closed' : 'opened'}`, 'global');
        }

        async function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            const typingIndicator = addTypingIndicator();
            
            try {
                // Simulate AI response (in a real app, this would call an API)
                setTimeout(() => {
                    // Remove typing indicator
                    typingIndicator.remove();
                    
                    // Generate AI response based on message
                    const response = generateAIResponse(message);
                    addChatMessage(response, 'ai');
                    
                    // Log AI interaction
                    logUserActivity('ai_chat_message', `AI chat: ${message.substring(0, 50)}...`, 'global', {
                        userMessage: message,
                        aiResponse: response
                    });
                }, 1500);
                
            } catch (error) {
                console.error('AI chat error:', error);
                typingIndicator.remove();
                addChatMessage('I apologize, but I encountered an error. Please try again or contact our support team.', 'ai');
            }
        }

        function addChatMessage(message, sender) {
            const chatBody = document.getElementById('aiChatBody');
            const messageElement = document.createElement('div');
            messageElement.className = sender === 'user' ? 'ai-user-message' : 'ai-bot-message';
            messageElement.textContent = message;
            chatBody.appendChild(messageElement);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function addTypingIndicator() {
            const chatBody = document.getElementById('aiChatBody');
            const indicator = document.createElement('div');
            indicator.className = 'ai-bot-message';
            indicator.innerHTML = '<span class="ai-chat-typing">Thinking</span>';
            chatBody.appendChild(indicator);
            chatBody.scrollTop = chatBody.scrollHeight;
            return indicator;
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Investment-related queries
            if (lowerMessage.includes('investment') || lowerMessage.includes('plan') || lowerMessage.includes('strategy')) {
                return "Our investment strategies are risk-calibrated based on allocation size. We offer three main approaches: Emerging Opportunities ($50-$499, higher growth potential), Strategic Growth ($500-$4,999, balanced approach), and Institutional Portfolio ($5,000+, capital preservation focus). Each strategy is diversified across equities, forex, and digital assets.";
            }
            
            // Returns-related queries
            if (lowerMessage.includes('return') || lowerMessage.includes('profit') || lowerMessage.includes('earning')) {
                return "Our target returns vary by strategy: Emerging Opportunities targets 10-20% monthly, Strategic Growth aims for 6-14% monthly, and Institutional Portfolio focuses on 3-9% monthly. Actual performance depends on market conditions and is not guaranteed. All investments carry risk.";
            }
            
            // Security-related queries
            if (lowerMessage.includes('security') || lowerMessage.includes('safe') || lowerMessage.includes('protect')) {
                return "Security is our top priority. We employ bank-grade encryption, multi-signature wallets, segregated client accounts, and regular security audits. Your capital and personal information are protected with institutional-grade security measures.";
            }
            
            // Withdrawal-related queries
            if (lowerMessage.includes('withdraw') || lowerMessage.includes('cash out') || lowerMessage.includes('transfer')) {
                return "Withdrawals can be requested from your dashboard and are typically processed within 24-48 hours. We support Bitcoin, Ethereum, and Binance Coin withdrawals. There's a minimum withdrawal amount of $50, and standard network fees apply.";
            }
            
            // Account-related queries
            if (lowerMessage.includes('account') || lowerMessage.includes('login') || lowerMessage.includes('register')) {
                return "You can register for an account using the registration form. If you already have an account, simply log in with your email and password. If you're having trouble accessing your account, please contact our support team at nexussmartinvest@gmail.com.";
            }
            
            // General greeting
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                return "Hello! I'm the Nexus AI Assistant. I can help answer questions about our investment strategies, account management, security measures, and more. What would you like to know?";
            }
            
            // Default response
            return "Thank you for your question. I'm here to help with information about Nexus investment strategies, account management, security, and withdrawals. For specific account inquiries or detailed assistance, please contact our support team at nexussmartinvest@gmail.com.";
        }

        // ===== ENHANCED UTILITY FUNCTIONS =====
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(amount);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showNotification('Failed to copy to clipboard', 'error');
            });
        }

        function showNotification(message, type) {
            const notificationCenter = document.getElementById('notificationCenter');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${getNotificationIcon(type)}"></i>
                <span>${message}</span>
            `;
            
            notificationCenter.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function getNotificationIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                case 'info': return 'info-circle';
                default: return 'bell';
            }
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Update active nav link if it exists for this page
            const activeNavLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (activeNavLink) {
                activeNavLink.classList.add('active');
            }
            
            // Close mobile menu if open
            document.getElementById('nav-menu').classList.remove('show');
            
            // Log page view
            logUserActivity('page_view', `Viewed ${pageId.replace('-', ' ')}`, pageId);
        }

        function switchAuthTab(tabName) {
            // Update tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.auth-tab[data-tab="${tabName}"]`).classList.add('active');
            
            // Update forms
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        function switchDashboardSection(sectionId) {
            // Update navigation
            document.querySelectorAll('.dashboard-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.dashboard-link[data-section="${sectionId}"]`).classList.add('active');
            
            // Update sections
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            // Log section change
            logUserActivity('dashboard_section', `Viewed ${sectionId} section`, 'dashboard');
        }

        function initializeModal() {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const closeModal = document.querySelector('.close-modal');
            
            // Close modal when clicking X
            if (closeModal) {
                closeModal.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
            
            // Close modal when clicking outside the image
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        function initializePasswordToggles() {
            // Login password toggle
            const loginToggle = document.getElementById('login-password-toggle');
            const loginPassword = document.getElementById('login-password');
            
            if (loginToggle && loginPassword) {
                loginToggle.addEventListener('click', function() {
                    const type = loginPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    loginPassword.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            // Registration password toggles
            const regToggle = document.getElementById('reg-password-toggle');
            const regPassword = document.getElementById('password');
            
            if (regToggle && regPassword) {
                regToggle.addEventListener('click', function() {
                    const type = regPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    regPassword.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            const regConfirmToggle = document.getElementById('reg-confirm-password-toggle');
            const regConfirmPassword = document.getElementById('reg-confirm-password');
            
            if (regConfirmToggle && regConfirmPassword) {
                regConfirmToggle.addEventListener('click', function() {
                    const type = regConfirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    regConfirmPassword.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            // Settings password toggles
            const settingsToggle = document.getElementById('settings-password-toggle');
            const settingsPassword = document.getElementById('settings-password');
            
            if (settingsToggle && settingsPassword) {
                settingsToggle.addEventListener('click', function() {
                    const type = settingsPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    settingsPassword.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            const settingsConfirmToggle = document.getElementById('settings-confirm-password-toggle');
            const settingsConfirmPassword = document.getElementById('settings-confirm-password');
            
            if (settingsConfirmToggle && settingsConfirmPassword) {
                settingsConfirmToggle.addEventListener('click', function() {
                    const type = settingsConfirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    settingsConfirmPassword.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
        }

        function loadUserSettings() {
            if (!currentUser) return;
            
            // Load user data into settings form
            document.getElementById('settings-name').value = currentUser.fullName || '';
            document.getElementById('settings-username').value = currentUser.username || '';
            document.getElementById('settings-email').value = currentUser.email || '';
            document.getElementById('settings-phone').value = currentUser.phone || '';
            document.getElementById('settings-postal').value = currentUser.postal || '';
            document.getElementById('settings-country').value = currentUser.country || '';
        }

        function initializeApp() {
            // Initialize theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.classList.toggle('dark-mode', savedTheme === 'dark');
            document.getElementById('themeToggle').innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                this.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                
                // Log theme change
                logUserActivity('theme_changed', `Changed to ${isDark ? 'dark' : 'light'} theme`, 'global');
            });
            
            // Initialize weekly market insight
            updateWeeklyInsight();
        }

        function updateWeeklyInsight() {
            const insights = [
                "Global equity markets showing resilience amid economic uncertainty. Technology and healthcare sectors continue to outperform.",
                "Forex markets experiencing increased volatility. USD strength expected to moderate in coming weeks.",
                "Cryptocurrency markets stabilizing after recent corrections. Institutional adoption continues to drive long-term growth potential.",
                "Portfolio rebalancing opportunities emerging in emerging markets and select technology subsectors.",
                "Market sentiment improving as inflation concerns moderate. Consider strategic allocations to quality growth assets."
            ];
            
            const randomInsight = insights[Math.floor(Math.random() * insights.length)];
            const insightElement = document.getElementById('weekly-insight');
            
            if (insightElement) {
                insightElement.textContent = randomInsight;
            }
        }

        // ===== ENHANCED ERROR HANDLING =====
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            
            // Log error to Firestore if user is logged in
            if (currentUser) {
                logUserActivity('javascript_error', `Error: ${e.message}`, 'global', {
                    errorStack: e.error?.stack,
                    filename: e.filename,
                    lineno: e.lineno,
                    colno: e.colno
                });
            }
        });

        // Export functions for global access if needed
        window.NexusApp = {
            showPage,
            showNotification,
            formatCurrency,
            logout,
            currentUser: () => currentUser
        };
    </script>
</body>
</html>